{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { BaseLoggger, Html5QrcodeResultFactory, Html5QrcodeErrorFactory, Html5QrcodeSupportedFormats, isValidHtml5QrcodeSupportedFormats, Html5QrcodeConstants, isNullOrUndefined } from \"./core\";\nimport { Html5QrcodeStrings } from \"./strings\";\nimport { VideoConstraintsUtil } from \"./utils\";\nimport { Html5QrcodeShim } from \"./code-decoder\";\nimport { CameraFactory } from \"./camera/factories\";\nimport { CameraRetriever } from \"./camera/retriever\";\nimport { StateManagerFactory, Html5QrcodeScannerState } from \"./state-manager\";\n\nvar Constants = function (_super) {\n  __extends(Constants, _super);\n\n  function Constants() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Constants.DEFAULT_WIDTH = 300;\n  Constants.DEFAULT_WIDTH_OFFSET = 2;\n  Constants.FILE_SCAN_MIN_HEIGHT = 300;\n  Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING = 100;\n  Constants.MIN_QR_BOX_SIZE = 50;\n  Constants.SHADED_LEFT = 1;\n  Constants.SHADED_RIGHT = 2;\n  Constants.SHADED_TOP = 3;\n  Constants.SHADED_BOTTOM = 4;\n  Constants.SHADED_REGION_ELEMENT_ID = \"qr-shaded-region\";\n  Constants.VERBOSE = false;\n  Constants.BORDER_SHADER_DEFAULT_COLOR = \"#ffffff\";\n  Constants.BORDER_SHADER_MATCH_COLOR = \"rgb(90, 193, 56)\";\n  return Constants;\n}(Html5QrcodeConstants);\n\nvar InternalHtml5QrcodeConfig = function () {\n  function InternalHtml5QrcodeConfig(config, logger) {\n    this.logger = logger;\n    this.fps = Constants.SCAN_DEFAULT_FPS;\n\n    if (!config) {\n      this.disableFlip = Constants.DEFAULT_DISABLE_FLIP;\n    } else {\n      if (config.fps) {\n        this.fps = config.fps;\n      }\n\n      this.disableFlip = config.disableFlip === true;\n      this.qrbox = config.qrbox;\n      this.aspectRatio = config.aspectRatio;\n      this.videoConstraints = config.videoConstraints;\n    }\n  }\n\n  InternalHtml5QrcodeConfig.prototype.isMediaStreamConstraintsValid = function () {\n    if (!this.videoConstraints) {\n      this.logger.logError(\"Empty videoConstraints\", true);\n      return false;\n    }\n\n    return VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints, this.logger);\n  };\n\n  InternalHtml5QrcodeConfig.prototype.isShadedBoxEnabled = function () {\n    return !isNullOrUndefined(this.qrbox);\n  };\n\n  InternalHtml5QrcodeConfig.create = function (config, logger) {\n    return new InternalHtml5QrcodeConfig(config, logger);\n  };\n\n  return InternalHtml5QrcodeConfig;\n}();\n\nvar Html5Qrcode = function () {\n  function Html5Qrcode(elementId, configOrVerbosityFlag) {\n    this.element = null;\n    this.canvasElement = null;\n    this.scannerPausedUiElement = null;\n    this.hasBorderShaders = null;\n    this.borderShaders = null;\n    this.qrMatch = null;\n    this.renderedCamera = null;\n    this.qrRegion = null;\n    this.context = null;\n    this.lastScanImageFile = null;\n    this.isScanning = false;\n\n    if (!document.getElementById(elementId)) {\n      throw \"HTML Element with id=\".concat(elementId, \" not found\");\n    }\n\n    this.elementId = elementId;\n    this.verbose = false;\n    var experimentalFeatureConfig;\n    var configObject;\n\n    if (typeof configOrVerbosityFlag == \"boolean\") {\n      this.verbose = configOrVerbosityFlag === true;\n    } else if (configOrVerbosityFlag) {\n      configObject = configOrVerbosityFlag;\n      this.verbose = configObject.verbose === true;\n      experimentalFeatureConfig = configObject.experimentalFeatures;\n    }\n\n    this.logger = new BaseLoggger(this.verbose);\n    this.qrcode = new Html5QrcodeShim(this.getSupportedFormats(configOrVerbosityFlag), this.getUseBarCodeDetectorIfSupported(configObject), this.verbose, this.logger);\n    this.foreverScanTimeout;\n    this.shouldScan = true;\n    this.stateManagerProxy = StateManagerFactory.create();\n  }\n\n  Html5Qrcode.prototype.start = function (cameraIdOrConfig, configuration, qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n\n    if (!cameraIdOrConfig) {\n      throw \"cameraIdOrConfig is required\";\n    }\n\n    if (!qrCodeSuccessCallback || typeof qrCodeSuccessCallback != \"function\") {\n      throw \"qrCodeSuccessCallback is required and should be a function.\";\n    }\n\n    var qrCodeErrorCallbackInternal;\n\n    if (qrCodeErrorCallback) {\n      qrCodeErrorCallbackInternal = qrCodeErrorCallback;\n    } else {\n      qrCodeErrorCallbackInternal = this.verbose ? this.logger.log : function () {};\n    }\n\n    var internalConfig = InternalHtml5QrcodeConfig.create(configuration, this.logger);\n    this.clearElement();\n    var videoConstraintsAvailableAndValid = false;\n\n    if (internalConfig.videoConstraints) {\n      if (!internalConfig.isMediaStreamConstraintsValid()) {\n        this.logger.logError(\"'videoConstraints' is not valid 'MediaStreamConstraints, \" + \"it will be ignored.'\", true);\n      } else {\n        videoConstraintsAvailableAndValid = true;\n      }\n    }\n\n    var areVideoConstraintsEnabled = videoConstraintsAvailableAndValid;\n    var element = document.getElementById(this.elementId);\n    var rootElementWidth = element.clientWidth ? element.clientWidth : Constants.DEFAULT_WIDTH;\n    element.style.position = \"relative\";\n    this.shouldScan = true;\n    this.element = element;\n    var $this = this;\n    var toScanningStateChangeTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);\n    return new Promise(function (resolve, reject) {\n      var videoConstraints = areVideoConstraintsEnabled ? internalConfig.videoConstraints : $this.createVideoConstraints(cameraIdOrConfig);\n\n      if (!videoConstraints) {\n        toScanningStateChangeTransaction.cancel();\n        reject(\"videoConstraints should be defined\");\n        return;\n      }\n\n      var cameraRenderingOptions = {};\n\n      if (!areVideoConstraintsEnabled || internalConfig.aspectRatio) {\n        cameraRenderingOptions.aspectRatio = internalConfig.aspectRatio;\n      }\n\n      var renderingCallbacks = {\n        onRenderSurfaceReady: function (viewfinderWidth, viewfinderHeight) {\n          $this.setupUi(viewfinderWidth, viewfinderHeight, internalConfig);\n          $this.isScanning = true;\n          $this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallbackInternal);\n        }\n      };\n      CameraFactory.failIfNotSupported().then(function (factory) {\n        factory.create(videoConstraints).then(function (camera) {\n          return camera.render(_this.element, cameraRenderingOptions, renderingCallbacks).then(function (renderedCamera) {\n            $this.renderedCamera = renderedCamera;\n            toScanningStateChangeTransaction.execute();\n            resolve(null);\n          }).catch(function (error) {\n            toScanningStateChangeTransaction.cancel();\n            reject(error);\n          });\n        }).catch(function (error) {\n          toScanningStateChangeTransaction.cancel();\n          reject(Html5QrcodeStrings.errorGettingUserMedia(error));\n        });\n      }).catch(function (_) {\n        toScanningStateChangeTransaction.cancel();\n        reject(Html5QrcodeStrings.cameraStreamingNotSupported());\n      });\n    });\n  };\n\n  Html5Qrcode.prototype.pause = function (shouldPauseVideo) {\n    if (!this.stateManagerProxy.isStrictlyScanning()) {\n      throw \"Cannot pause, scanner is not scanning.\";\n    }\n\n    this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED);\n    this.showPausedState();\n\n    if (isNullOrUndefined(shouldPauseVideo) || shouldPauseVideo !== true) {\n      shouldPauseVideo = false;\n    }\n\n    if (shouldPauseVideo && this.renderedCamera) {\n      this.renderedCamera.pause();\n    }\n  };\n\n  Html5Qrcode.prototype.resume = function () {\n    if (!this.stateManagerProxy.isPaused()) {\n      throw \"Cannot result, scanner is not paused.\";\n    }\n\n    if (!this.renderedCamera) {\n      throw \"renderedCamera doesn't exist while trying resume()\";\n    }\n\n    var $this = this;\n\n    var transitionToScanning = function () {\n      $this.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING);\n      $this.hidePausedState();\n    };\n\n    if (!this.renderedCamera.isPaused()) {\n      transitionToScanning();\n      return;\n    }\n\n    this.renderedCamera.resume(function () {\n      transitionToScanning();\n    });\n  };\n\n  Html5Qrcode.prototype.getState = function () {\n    return this.stateManagerProxy.getState();\n  };\n\n  Html5Qrcode.prototype.stop = function () {\n    var _this = this;\n\n    if (!this.stateManagerProxy.isScanning()) {\n      throw \"Cannot stop, scanner is not running or paused.\";\n    }\n\n    var toStoppedStateTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);\n    this.shouldScan = false;\n\n    if (this.foreverScanTimeout) {\n      clearTimeout(this.foreverScanTimeout);\n    }\n\n    var removeQrRegion = function () {\n      if (!_this.element) {\n        return;\n      }\n\n      var childElement = document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);\n\n      if (childElement) {\n        _this.element.removeChild(childElement);\n      }\n    };\n\n    var $this = this;\n    return this.renderedCamera.close().then(function () {\n      $this.renderedCamera = null;\n\n      if ($this.element) {\n        $this.element.removeChild($this.canvasElement);\n        $this.canvasElement = null;\n      }\n\n      removeQrRegion();\n\n      if ($this.qrRegion) {\n        $this.qrRegion = null;\n      }\n\n      if ($this.context) {\n        $this.context = null;\n      }\n\n      toStoppedStateTransaction.execute();\n      $this.hidePausedState();\n      $this.isScanning = false;\n      return Promise.resolve();\n    });\n  };\n\n  Html5Qrcode.prototype.scanFile = function (imageFile, showImage) {\n    return this.scanFileV2(imageFile, showImage).then(function (html5qrcodeResult) {\n      return html5qrcodeResult.decodedText;\n    });\n  };\n\n  Html5Qrcode.prototype.scanFileV2 = function (imageFile, showImage) {\n    var _this = this;\n\n    if (!imageFile || !(imageFile instanceof File)) {\n      throw \"imageFile argument is mandatory and should be instance \" + \"of File. Use 'event.target.files[0]'.\";\n    }\n\n    if (isNullOrUndefined(showImage)) {\n      showImage = true;\n    }\n\n    if (!this.stateManagerProxy.canScanFile()) {\n      throw \"Cannot start file scan - ongoing camera scan\";\n    }\n\n    return new Promise(function (resolve, reject) {\n      _this.possiblyCloseLastScanImageFile();\n\n      _this.clearElement();\n\n      _this.lastScanImageFile = URL.createObjectURL(imageFile);\n      var inputImage = new Image();\n\n      inputImage.onload = function () {\n        var imageWidth = inputImage.width;\n        var imageHeight = inputImage.height;\n        var element = document.getElementById(_this.elementId);\n        var containerWidth = element.clientWidth ? element.clientWidth : Constants.DEFAULT_WIDTH;\n        var containerHeight = Math.max(element.clientHeight ? element.clientHeight : imageHeight, Constants.FILE_SCAN_MIN_HEIGHT);\n\n        var config = _this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n\n        if (showImage) {\n          var visibleCanvas = _this.createCanvasElement(containerWidth, containerHeight, \"qr-canvas-visible\");\n\n          visibleCanvas.style.display = \"inline-block\";\n          element.appendChild(visibleCanvas);\n          var context_1 = visibleCanvas.getContext(\"2d\");\n\n          if (!context_1) {\n            throw \"Unable to get 2d context from canvas\";\n          }\n\n          context_1.canvas.width = containerWidth;\n          context_1.canvas.height = containerHeight;\n          context_1.drawImage(inputImage, 0, 0, imageWidth, imageHeight, config.x, config.y, config.width, config.height);\n        }\n\n        var padding = Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING;\n        var hiddenImageWidth = Math.max(inputImage.width, config.width);\n        var hiddenImageHeight = Math.max(inputImage.height, config.height);\n        var hiddenCanvasWidth = hiddenImageWidth + 2 * padding;\n        var hiddenCanvasHeight = hiddenImageHeight + 2 * padding;\n\n        var hiddenCanvas = _this.createCanvasElement(hiddenCanvasWidth, hiddenCanvasHeight);\n\n        element.appendChild(hiddenCanvas);\n        var context = hiddenCanvas.getContext(\"2d\");\n\n        if (!context) {\n          throw \"Unable to get 2d context from canvas\";\n        }\n\n        context.canvas.width = hiddenCanvasWidth;\n        context.canvas.height = hiddenCanvasHeight;\n        context.drawImage(inputImage, 0, 0, imageWidth, imageHeight, padding, padding, hiddenImageWidth, hiddenImageHeight);\n\n        try {\n          _this.qrcode.decodeRobustlyAsync(hiddenCanvas).then(function (result) {\n            resolve(Html5QrcodeResultFactory.createFromQrcodeResult(result));\n          }).catch(reject);\n        } catch (exception) {\n          reject(\"QR code parse error, error = \".concat(exception));\n        }\n      };\n\n      inputImage.onerror = reject;\n      inputImage.onabort = reject;\n      inputImage.onstalled = reject;\n      inputImage.onsuspend = reject;\n      inputImage.src = URL.createObjectURL(imageFile);\n    });\n  };\n\n  Html5Qrcode.prototype.clear = function () {\n    this.clearElement();\n  };\n\n  Html5Qrcode.getCameras = function () {\n    return CameraRetriever.retrieve();\n  };\n\n  Html5Qrcode.prototype.getRunningTrackCapabilities = function () {\n    return this.getRenderedCameraOrFail().getRunningTrackCapabilities();\n  };\n\n  Html5Qrcode.prototype.getRunningTrackSettings = function () {\n    return this.getRenderedCameraOrFail().getRunningTrackSettings();\n  };\n\n  Html5Qrcode.prototype.getRunningTrackCameraCapabilities = function () {\n    return this.getRenderedCameraOrFail().getCapabilities();\n  };\n\n  Html5Qrcode.prototype.applyVideoConstraints = function (videoConstaints) {\n    if (!videoConstaints) {\n      throw \"videoConstaints is required argument.\";\n    } else if (!VideoConstraintsUtil.isMediaStreamConstraintsValid(videoConstaints, this.logger)) {\n      throw \"invalid videoConstaints passed, check logs for more details\";\n    }\n\n    return this.getRenderedCameraOrFail().applyVideoConstraints(videoConstaints);\n  };\n\n  Html5Qrcode.prototype.getRenderedCameraOrFail = function () {\n    if (this.renderedCamera == null) {\n      throw \"Scanning is not in running state, call this API only when\" + \" QR code scanning using camera is in running state.\";\n    }\n\n    return this.renderedCamera;\n  };\n\n  Html5Qrcode.prototype.getSupportedFormats = function (configOrVerbosityFlag) {\n    var allFormats = [Html5QrcodeSupportedFormats.QR_CODE, Html5QrcodeSupportedFormats.AZTEC, Html5QrcodeSupportedFormats.CODABAR, Html5QrcodeSupportedFormats.CODE_39, Html5QrcodeSupportedFormats.CODE_93, Html5QrcodeSupportedFormats.CODE_128, Html5QrcodeSupportedFormats.DATA_MATRIX, Html5QrcodeSupportedFormats.MAXICODE, Html5QrcodeSupportedFormats.ITF, Html5QrcodeSupportedFormats.EAN_13, Html5QrcodeSupportedFormats.EAN_8, Html5QrcodeSupportedFormats.PDF_417, Html5QrcodeSupportedFormats.RSS_14, Html5QrcodeSupportedFormats.RSS_EXPANDED, Html5QrcodeSupportedFormats.UPC_A, Html5QrcodeSupportedFormats.UPC_E, Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION];\n\n    if (!configOrVerbosityFlag || typeof configOrVerbosityFlag == \"boolean\") {\n      return allFormats;\n    }\n\n    if (!configOrVerbosityFlag.formatsToSupport) {\n      return allFormats;\n    }\n\n    if (!Array.isArray(configOrVerbosityFlag.formatsToSupport)) {\n      throw \"configOrVerbosityFlag.formatsToSupport should be undefined \" + \"or an array.\";\n    }\n\n    if (configOrVerbosityFlag.formatsToSupport.length === 0) {\n      throw \"Atleast 1 formatsToSupport is needed.\";\n    }\n\n    var supportedFormats = [];\n\n    for (var _i = 0, _a = configOrVerbosityFlag.formatsToSupport; _i < _a.length; _i++) {\n      var format = _a[_i];\n\n      if (isValidHtml5QrcodeSupportedFormats(format)) {\n        supportedFormats.push(format);\n      } else {\n        this.logger.warn(\"Invalid format: \".concat(format, \" passed in config, ignoring.\"));\n      }\n    }\n\n    if (supportedFormats.length === 0) {\n      throw \"None of formatsToSupport match supported values.\";\n    }\n\n    return supportedFormats;\n  };\n\n  Html5Qrcode.prototype.getUseBarCodeDetectorIfSupported = function (config) {\n    if (isNullOrUndefined(config)) {\n      return true;\n    }\n\n    if (!isNullOrUndefined(config.useBarCodeDetectorIfSupported)) {\n      return config.useBarCodeDetectorIfSupported !== false;\n    }\n\n    if (isNullOrUndefined(config.experimentalFeatures)) {\n      return true;\n    }\n\n    var experimentalFeatures = config.experimentalFeatures;\n\n    if (isNullOrUndefined(experimentalFeatures.useBarCodeDetectorIfSupported)) {\n      return true;\n    }\n\n    return experimentalFeatures.useBarCodeDetectorIfSupported !== false;\n  };\n\n  Html5Qrcode.prototype.validateQrboxSize = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n    var _this = this;\n\n    var qrboxSize = internalConfig.qrbox;\n    this.validateQrboxConfig(qrboxSize);\n    var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n\n    var validateMinSize = function (size) {\n      if (size < Constants.MIN_QR_BOX_SIZE) {\n        throw \"minimum size of 'config.qrbox' dimension value is\" + \" \".concat(Constants.MIN_QR_BOX_SIZE, \"px.\");\n      }\n    };\n\n    var correctWidthBasedOnRootElementSize = function (configWidth) {\n      if (configWidth > viewfinderWidth) {\n        _this.logger.warn(\"`qrbox.width` or `qrbox` is larger than the\" + \" width of the root element. The width will be truncated\" + \" to the width of root element.\");\n\n        configWidth = viewfinderWidth;\n      }\n\n      return configWidth;\n    };\n\n    validateMinSize(qrDimensions.width);\n    validateMinSize(qrDimensions.height);\n    qrDimensions.width = correctWidthBasedOnRootElementSize(qrDimensions.width);\n  };\n\n  Html5Qrcode.prototype.validateQrboxConfig = function (qrboxSize) {\n    if (typeof qrboxSize === \"number\") {\n      return;\n    }\n\n    if (typeof qrboxSize === \"function\") {\n      return;\n    }\n\n    if (qrboxSize.width === undefined || qrboxSize.height === undefined) {\n      throw \"Invalid instance of QrDimensions passed for \" + \"'config.qrbox'. Both 'width' and 'height' should be set.\";\n    }\n  };\n\n  Html5Qrcode.prototype.toQrdimensions = function (viewfinderWidth, viewfinderHeight, qrboxSize) {\n    if (typeof qrboxSize === \"number\") {\n      return {\n        width: qrboxSize,\n        height: qrboxSize\n      };\n    } else if (typeof qrboxSize === \"function\") {\n      try {\n        return qrboxSize(viewfinderWidth, viewfinderHeight);\n      } catch (error) {\n        throw new Error(\"qrbox config was passed as a function but it failed with \" + \"unknown error\" + error);\n      }\n    }\n\n    return qrboxSize;\n  };\n\n  Html5Qrcode.prototype.setupUi = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n    if (internalConfig.isShadedBoxEnabled()) {\n      this.validateQrboxSize(viewfinderWidth, viewfinderHeight, internalConfig);\n    }\n\n    var qrboxSize = isNullOrUndefined(internalConfig.qrbox) ? {\n      width: viewfinderWidth,\n      height: viewfinderHeight\n    } : internalConfig.qrbox;\n    this.validateQrboxConfig(qrboxSize);\n    var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n\n    if (qrDimensions.height > viewfinderHeight) {\n      this.logger.warn(\"[Html5Qrcode] config.qrbox has height that is\" + \"greater than the height of the video stream. Shading will be\" + \" ignored\");\n    }\n\n    var shouldShadingBeApplied = internalConfig.isShadedBoxEnabled() && qrDimensions.height <= viewfinderHeight;\n    var defaultQrRegion = {\n      x: 0,\n      y: 0,\n      width: viewfinderWidth,\n      height: viewfinderHeight\n    };\n    var qrRegion = shouldShadingBeApplied ? this.getShadedRegionBounds(viewfinderWidth, viewfinderHeight, qrDimensions) : defaultQrRegion;\n    var canvasElement = this.createCanvasElement(qrRegion.width, qrRegion.height);\n    var contextAttributes = {\n      willReadFrequently: true\n    };\n    var context = canvasElement.getContext(\"2d\", contextAttributes);\n    context.canvas.width = qrRegion.width;\n    context.canvas.height = qrRegion.height;\n    this.element.append(canvasElement);\n\n    if (shouldShadingBeApplied) {\n      this.possiblyInsertShadingElement(this.element, viewfinderWidth, viewfinderHeight, qrDimensions);\n    }\n\n    this.createScannerPausedUiElement(this.element);\n    this.qrRegion = qrRegion;\n    this.context = context;\n    this.canvasElement = canvasElement;\n  };\n\n  Html5Qrcode.prototype.createScannerPausedUiElement = function (rootElement) {\n    var scannerPausedUiElement = document.createElement(\"div\");\n    scannerPausedUiElement.innerText = Html5QrcodeStrings.scannerPaused();\n    scannerPausedUiElement.style.display = \"none\";\n    scannerPausedUiElement.style.position = \"absolute\";\n    scannerPausedUiElement.style.top = \"0px\";\n    scannerPausedUiElement.style.zIndex = \"1\";\n    scannerPausedUiElement.style.background = \"rgba(9, 9, 9, 0.46)\";\n    scannerPausedUiElement.style.color = \"#FFECEC\";\n    scannerPausedUiElement.style.textAlign = \"center\";\n    scannerPausedUiElement.style.width = \"100%\";\n    rootElement.appendChild(scannerPausedUiElement);\n    this.scannerPausedUiElement = scannerPausedUiElement;\n  };\n\n  Html5Qrcode.prototype.scanContext = function (qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n\n    if (this.stateManagerProxy.isPaused()) {\n      return Promise.resolve(false);\n    }\n\n    return this.qrcode.decodeAsync(this.canvasElement).then(function (result) {\n      qrCodeSuccessCallback(result.text, Html5QrcodeResultFactory.createFromQrcodeResult(result));\n\n      _this.possiblyUpdateShaders(true);\n\n      return true;\n    }).catch(function (error) {\n      _this.possiblyUpdateShaders(false);\n\n      var errorMessage = Html5QrcodeStrings.codeParseError(error);\n      qrCodeErrorCallback(errorMessage, Html5QrcodeErrorFactory.createFrom(errorMessage));\n      return false;\n    });\n  };\n\n  Html5Qrcode.prototype.foreverScan = function (internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n\n    if (!this.shouldScan) {\n      return;\n    }\n\n    if (!this.renderedCamera) {\n      return;\n    }\n\n    var videoElement = this.renderedCamera.getSurface();\n    var widthRatio = videoElement.videoWidth / videoElement.clientWidth;\n    var heightRatio = videoElement.videoHeight / videoElement.clientHeight;\n\n    if (!this.qrRegion) {\n      throw \"qrRegion undefined when localMediaStream is ready.\";\n    }\n\n    var sWidthOffset = this.qrRegion.width * widthRatio;\n    var sHeightOffset = this.qrRegion.height * heightRatio;\n    var sxOffset = this.qrRegion.x * widthRatio;\n    var syOffset = this.qrRegion.y * heightRatio;\n    this.context.drawImage(videoElement, sxOffset, syOffset, sWidthOffset, sHeightOffset, 0, 0, this.qrRegion.width, this.qrRegion.height);\n\n    var triggerNextScan = function () {\n      _this.foreverScanTimeout = setTimeout(function () {\n        _this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback);\n      }, _this.getTimeoutFps(internalConfig.fps));\n    };\n\n    this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback).then(function (isSuccessfull) {\n      if (!isSuccessfull && internalConfig.disableFlip !== true) {\n        _this.context.translate(_this.context.canvas.width, 0);\n\n        _this.context.scale(-1, 1);\n\n        _this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback).finally(function () {\n          triggerNextScan();\n        });\n      } else {\n        triggerNextScan();\n      }\n    }).catch(function (error) {\n      _this.logger.logError(\"Error happend while scanning context\", error);\n\n      triggerNextScan();\n    });\n  };\n\n  Html5Qrcode.prototype.createVideoConstraints = function (cameraIdOrConfig) {\n    if (typeof cameraIdOrConfig == \"string\") {\n      return {\n        deviceId: {\n          exact: cameraIdOrConfig\n        }\n      };\n    } else if (typeof cameraIdOrConfig == \"object\") {\n      var facingModeKey = \"facingMode\";\n      var deviceIdKey = \"deviceId\";\n      var allowedFacingModeValues_1 = {\n        \"user\": true,\n        \"environment\": true\n      };\n      var exactKey = \"exact\";\n\n      var isValidFacingModeValue = function (value) {\n        if (value in allowedFacingModeValues_1) {\n          return true;\n        } else {\n          throw \"config has invalid 'facingMode' value = \" + \"'\".concat(value, \"'\");\n        }\n      };\n\n      var keys = Object.keys(cameraIdOrConfig);\n\n      if (keys.length !== 1) {\n        throw \"'cameraIdOrConfig' object should have exactly 1 key,\" + \" if passed as an object, found \".concat(keys.length, \" keys\");\n      }\n\n      var key = Object.keys(cameraIdOrConfig)[0];\n\n      if (key !== facingModeKey && key !== deviceIdKey) {\n        throw \"Only '\".concat(facingModeKey, \"' and '\").concat(deviceIdKey, \"' \") + \" are supported for 'cameraIdOrConfig'\";\n      }\n\n      if (key === facingModeKey) {\n        var facingMode = cameraIdOrConfig.facingMode;\n\n        if (typeof facingMode == \"string\") {\n          if (isValidFacingModeValue(facingMode)) {\n            return {\n              facingMode: facingMode\n            };\n          }\n        } else if (typeof facingMode == \"object\") {\n          if (exactKey in facingMode) {\n            if (isValidFacingModeValue(facingMode[\"\".concat(exactKey)])) {\n              return {\n                facingMode: {\n                  exact: facingMode[\"\".concat(exactKey)]\n                }\n              };\n            }\n          } else {\n            throw \"'facingMode' should be string or object with\" + \" \".concat(exactKey, \" as key.\");\n          }\n        } else {\n          var type_1 = typeof facingMode;\n          throw \"Invalid type of 'facingMode' = \".concat(type_1);\n        }\n      } else {\n        var deviceId = cameraIdOrConfig.deviceId;\n\n        if (typeof deviceId == \"string\") {\n          return {\n            deviceId: deviceId\n          };\n        } else if (typeof deviceId == \"object\") {\n          if (exactKey in deviceId) {\n            return {\n              deviceId: {\n                exact: deviceId[\"\".concat(exactKey)]\n              }\n            };\n          } else {\n            throw \"'deviceId' should be string or object with\" + \" \".concat(exactKey, \" as key.\");\n          }\n        } else {\n          var type_2 = typeof deviceId;\n          throw \"Invalid type of 'deviceId' = \".concat(type_2);\n        }\n      }\n    }\n\n    var type = typeof cameraIdOrConfig;\n    throw \"Invalid type of 'cameraIdOrConfig' = \".concat(type);\n  };\n\n  Html5Qrcode.prototype.computeCanvasDrawConfig = function (imageWidth, imageHeight, containerWidth, containerHeight) {\n    if (imageWidth <= containerWidth && imageHeight <= containerHeight) {\n      var xoffset = (containerWidth - imageWidth) / 2;\n      var yoffset = (containerHeight - imageHeight) / 2;\n      return {\n        x: xoffset,\n        y: yoffset,\n        width: imageWidth,\n        height: imageHeight\n      };\n    } else {\n      var formerImageWidth = imageWidth;\n      var formerImageHeight = imageHeight;\n\n      if (imageWidth > containerWidth) {\n        imageHeight = containerWidth / imageWidth * imageHeight;\n        imageWidth = containerWidth;\n      }\n\n      if (imageHeight > containerHeight) {\n        imageWidth = containerHeight / imageHeight * imageWidth;\n        imageHeight = containerHeight;\n      }\n\n      this.logger.log(\"Image downsampled from \" + \"\".concat(formerImageWidth, \"X\").concat(formerImageHeight) + \" to \".concat(imageWidth, \"X\").concat(imageHeight, \".\"));\n      return this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n    }\n  };\n\n  Html5Qrcode.prototype.clearElement = function () {\n    if (this.stateManagerProxy.isScanning()) {\n      throw \"Cannot clear while scan is ongoing, close it first.\";\n    }\n\n    var element = document.getElementById(this.elementId);\n\n    if (element) {\n      element.innerHTML = \"\";\n    }\n  };\n\n  Html5Qrcode.prototype.possiblyUpdateShaders = function (qrMatch) {\n    if (this.qrMatch === qrMatch) {\n      return;\n    }\n\n    if (this.hasBorderShaders && this.borderShaders && this.borderShaders.length) {\n      this.borderShaders.forEach(function (shader) {\n        shader.style.backgroundColor = qrMatch ? Constants.BORDER_SHADER_MATCH_COLOR : Constants.BORDER_SHADER_DEFAULT_COLOR;\n      });\n    }\n\n    this.qrMatch = qrMatch;\n  };\n\n  Html5Qrcode.prototype.possiblyCloseLastScanImageFile = function () {\n    if (this.lastScanImageFile) {\n      URL.revokeObjectURL(this.lastScanImageFile);\n      this.lastScanImageFile = null;\n    }\n  };\n\n  Html5Qrcode.prototype.createCanvasElement = function (width, height, customId) {\n    var canvasWidth = width;\n    var canvasHeight = height;\n    var canvasElement = document.createElement(\"canvas\");\n    canvasElement.style.width = \"\".concat(canvasWidth, \"px\");\n    canvasElement.style.height = \"\".concat(canvasHeight, \"px\");\n    canvasElement.style.display = \"none\";\n    canvasElement.id = isNullOrUndefined(customId) ? \"qr-canvas\" : customId;\n    return canvasElement;\n  };\n\n  Html5Qrcode.prototype.getShadedRegionBounds = function (width, height, qrboxSize) {\n    if (qrboxSize.width > width || qrboxSize.height > height) {\n      throw \"'config.qrbox' dimensions should not be greater than the \" + \"dimensions of the root HTML element.\";\n    }\n\n    return {\n      x: (width - qrboxSize.width) / 2,\n      y: (height - qrboxSize.height) / 2,\n      width: qrboxSize.width,\n      height: qrboxSize.height\n    };\n  };\n\n  Html5Qrcode.prototype.possiblyInsertShadingElement = function (element, width, height, qrboxSize) {\n    if (width - qrboxSize.width < 1 || height - qrboxSize.height < 1) {\n      return;\n    }\n\n    var shadingElement = document.createElement(\"div\");\n    shadingElement.style.position = \"absolute\";\n    var rightLeftBorderSize = (width - qrboxSize.width) / 2;\n    var topBottomBorderSize = (height - qrboxSize.height) / 2;\n    shadingElement.style.borderLeft = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.borderRight = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.borderTop = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.borderBottom = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n    shadingElement.style.boxSizing = \"border-box\";\n    shadingElement.style.top = \"0px\";\n    shadingElement.style.bottom = \"0px\";\n    shadingElement.style.left = \"0px\";\n    shadingElement.style.right = \"0px\";\n    shadingElement.id = \"\".concat(Constants.SHADED_REGION_ELEMENT_ID);\n\n    if (width - qrboxSize.width < 11 || height - qrboxSize.height < 11) {\n      this.hasBorderShaders = false;\n    } else {\n      var smallSize = 5;\n      var largeSize = 40;\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, true);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, false);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, true);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, false);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, true);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, true);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, false);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, false);\n      this.hasBorderShaders = true;\n    }\n\n    element.append(shadingElement);\n  };\n\n  Html5Qrcode.prototype.insertShaderBorders = function (shaderElem, width, height, top, bottom, side, isLeft) {\n    var elem = document.createElement(\"div\");\n    elem.style.position = \"absolute\";\n    elem.style.backgroundColor = Constants.BORDER_SHADER_DEFAULT_COLOR;\n    elem.style.width = \"\".concat(width, \"px\");\n    elem.style.height = \"\".concat(height, \"px\");\n\n    if (top !== null) {\n      elem.style.top = \"\".concat(top, \"px\");\n    }\n\n    if (bottom !== null) {\n      elem.style.bottom = \"\".concat(bottom, \"px\");\n    }\n\n    if (isLeft) {\n      elem.style.left = \"\".concat(side, \"px\");\n    } else {\n      elem.style.right = \"\".concat(side, \"px\");\n    }\n\n    if (!this.borderShaders) {\n      this.borderShaders = [];\n    }\n\n    this.borderShaders.push(elem);\n    shaderElem.appendChild(elem);\n  };\n\n  Html5Qrcode.prototype.showPausedState = function () {\n    if (!this.scannerPausedUiElement) {\n      throw \"[internal error] scanner paused UI element not found\";\n    }\n\n    this.scannerPausedUiElement.style.display = \"block\";\n  };\n\n  Html5Qrcode.prototype.hidePausedState = function () {\n    if (!this.scannerPausedUiElement) {\n      throw \"[internal error] scanner paused UI element not found\";\n    }\n\n    this.scannerPausedUiElement.style.display = \"none\";\n  };\n\n  Html5Qrcode.prototype.getTimeoutFps = function (fps) {\n    return 1000 / fps;\n  };\n\n  return Html5Qrcode;\n}();\n\nexport { Html5Qrcode };","map":{"version":3,"sources":["../../src/html5-qrcode.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseLoggger, Html5QrcodeResultFactory, Html5QrcodeErrorFactory, Html5QrcodeSupportedFormats, isValidHtml5QrcodeSupportedFormats, Html5QrcodeConstants, isNullOrUndefined } from \"./core\";\nimport { Html5QrcodeStrings } from \"./strings\";\nimport { VideoConstraintsUtil } from \"./utils\";\nimport { Html5QrcodeShim } from \"./code-decoder\";\nimport { CameraFactory } from \"./camera/factories\";\nimport { CameraRetriever } from \"./camera/retriever\";\nimport { StateManagerFactory, Html5QrcodeScannerState } from \"./state-manager\";\nvar Constants = (function (_super) {\n    __extends(Constants, _super);\n    function Constants() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Constants.DEFAULT_WIDTH = 300;\n    Constants.DEFAULT_WIDTH_OFFSET = 2;\n    Constants.FILE_SCAN_MIN_HEIGHT = 300;\n    Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING = 100;\n    Constants.MIN_QR_BOX_SIZE = 50;\n    Constants.SHADED_LEFT = 1;\n    Constants.SHADED_RIGHT = 2;\n    Constants.SHADED_TOP = 3;\n    Constants.SHADED_BOTTOM = 4;\n    Constants.SHADED_REGION_ELEMENT_ID = \"qr-shaded-region\";\n    Constants.VERBOSE = false;\n    Constants.BORDER_SHADER_DEFAULT_COLOR = \"#ffffff\";\n    Constants.BORDER_SHADER_MATCH_COLOR = \"rgb(90, 193, 56)\";\n    return Constants;\n}(Html5QrcodeConstants));\nvar InternalHtml5QrcodeConfig = (function () {\n    function InternalHtml5QrcodeConfig(config, logger) {\n        this.logger = logger;\n        this.fps = Constants.SCAN_DEFAULT_FPS;\n        if (!config) {\n            this.disableFlip = Constants.DEFAULT_DISABLE_FLIP;\n        }\n        else {\n            if (config.fps) {\n                this.fps = config.fps;\n            }\n            this.disableFlip = config.disableFlip === true;\n            this.qrbox = config.qrbox;\n            this.aspectRatio = config.aspectRatio;\n            this.videoConstraints = config.videoConstraints;\n        }\n    }\n    InternalHtml5QrcodeConfig.prototype.isMediaStreamConstraintsValid = function () {\n        if (!this.videoConstraints) {\n            this.logger.logError(\"Empty videoConstraints\", true);\n            return false;\n        }\n        return VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints, this.logger);\n    };\n    InternalHtml5QrcodeConfig.prototype.isShadedBoxEnabled = function () {\n        return !isNullOrUndefined(this.qrbox);\n    };\n    InternalHtml5QrcodeConfig.create = function (config, logger) {\n        return new InternalHtml5QrcodeConfig(config, logger);\n    };\n    return InternalHtml5QrcodeConfig;\n}());\nvar Html5Qrcode = (function () {\n    function Html5Qrcode(elementId, configOrVerbosityFlag) {\n        this.element = null;\n        this.canvasElement = null;\n        this.scannerPausedUiElement = null;\n        this.hasBorderShaders = null;\n        this.borderShaders = null;\n        this.qrMatch = null;\n        this.renderedCamera = null;\n        this.qrRegion = null;\n        this.context = null;\n        this.lastScanImageFile = null;\n        this.isScanning = false;\n        if (!document.getElementById(elementId)) {\n            throw \"HTML Element with id=\".concat(elementId, \" not found\");\n        }\n        this.elementId = elementId;\n        this.verbose = false;\n        var experimentalFeatureConfig;\n        var configObject;\n        if (typeof configOrVerbosityFlag == \"boolean\") {\n            this.verbose = configOrVerbosityFlag === true;\n        }\n        else if (configOrVerbosityFlag) {\n            configObject = configOrVerbosityFlag;\n            this.verbose = configObject.verbose === true;\n            experimentalFeatureConfig = configObject.experimentalFeatures;\n        }\n        this.logger = new BaseLoggger(this.verbose);\n        this.qrcode = new Html5QrcodeShim(this.getSupportedFormats(configOrVerbosityFlag), this.getUseBarCodeDetectorIfSupported(configObject), this.verbose, this.logger);\n        this.foreverScanTimeout;\n        this.shouldScan = true;\n        this.stateManagerProxy = StateManagerFactory.create();\n    }\n    Html5Qrcode.prototype.start = function (cameraIdOrConfig, configuration, qrCodeSuccessCallback, qrCodeErrorCallback) {\n        var _this = this;\n        if (!cameraIdOrConfig) {\n            throw \"cameraIdOrConfig is required\";\n        }\n        if (!qrCodeSuccessCallback\n            || typeof qrCodeSuccessCallback != \"function\") {\n            throw \"qrCodeSuccessCallback is required and should be a function.\";\n        }\n        var qrCodeErrorCallbackInternal;\n        if (qrCodeErrorCallback) {\n            qrCodeErrorCallbackInternal = qrCodeErrorCallback;\n        }\n        else {\n            qrCodeErrorCallbackInternal\n                = this.verbose ? this.logger.log : function () { };\n        }\n        var internalConfig = InternalHtml5QrcodeConfig.create(configuration, this.logger);\n        this.clearElement();\n        var videoConstraintsAvailableAndValid = false;\n        if (internalConfig.videoConstraints) {\n            if (!internalConfig.isMediaStreamConstraintsValid()) {\n                this.logger.logError(\"'videoConstraints' is not valid 'MediaStreamConstraints, \"\n                    + \"it will be ignored.'\", true);\n            }\n            else {\n                videoConstraintsAvailableAndValid = true;\n            }\n        }\n        var areVideoConstraintsEnabled = videoConstraintsAvailableAndValid;\n        var element = document.getElementById(this.elementId);\n        var rootElementWidth = element.clientWidth\n            ? element.clientWidth : Constants.DEFAULT_WIDTH;\n        element.style.position = \"relative\";\n        this.shouldScan = true;\n        this.element = element;\n        var $this = this;\n        var toScanningStateChangeTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);\n        return new Promise(function (resolve, reject) {\n            var videoConstraints = areVideoConstraintsEnabled\n                ? internalConfig.videoConstraints\n                : $this.createVideoConstraints(cameraIdOrConfig);\n            if (!videoConstraints) {\n                toScanningStateChangeTransaction.cancel();\n                reject(\"videoConstraints should be defined\");\n                return;\n            }\n            var cameraRenderingOptions = {};\n            if (!areVideoConstraintsEnabled || internalConfig.aspectRatio) {\n                cameraRenderingOptions.aspectRatio = internalConfig.aspectRatio;\n            }\n            var renderingCallbacks = {\n                onRenderSurfaceReady: function (viewfinderWidth, viewfinderHeight) {\n                    $this.setupUi(viewfinderWidth, viewfinderHeight, internalConfig);\n                    $this.isScanning = true;\n                    $this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallbackInternal);\n                }\n            };\n            CameraFactory.failIfNotSupported().then(function (factory) {\n                factory.create(videoConstraints).then(function (camera) {\n                    return camera.render(_this.element, cameraRenderingOptions, renderingCallbacks)\n                        .then(function (renderedCamera) {\n                        $this.renderedCamera = renderedCamera;\n                        toScanningStateChangeTransaction.execute();\n                        resolve(null);\n                    })\n                        .catch(function (error) {\n                        toScanningStateChangeTransaction.cancel();\n                        reject(error);\n                    });\n                }).catch(function (error) {\n                    toScanningStateChangeTransaction.cancel();\n                    reject(Html5QrcodeStrings.errorGettingUserMedia(error));\n                });\n            }).catch(function (_) {\n                toScanningStateChangeTransaction.cancel();\n                reject(Html5QrcodeStrings.cameraStreamingNotSupported());\n            });\n        });\n    };\n    Html5Qrcode.prototype.pause = function (shouldPauseVideo) {\n        if (!this.stateManagerProxy.isStrictlyScanning()) {\n            throw \"Cannot pause, scanner is not scanning.\";\n        }\n        this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED);\n        this.showPausedState();\n        if (isNullOrUndefined(shouldPauseVideo) || shouldPauseVideo !== true) {\n            shouldPauseVideo = false;\n        }\n        if (shouldPauseVideo && this.renderedCamera) {\n            this.renderedCamera.pause();\n        }\n    };\n    Html5Qrcode.prototype.resume = function () {\n        if (!this.stateManagerProxy.isPaused()) {\n            throw \"Cannot result, scanner is not paused.\";\n        }\n        if (!this.renderedCamera) {\n            throw \"renderedCamera doesn't exist while trying resume()\";\n        }\n        var $this = this;\n        var transitionToScanning = function () {\n            $this.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING);\n            $this.hidePausedState();\n        };\n        if (!this.renderedCamera.isPaused()) {\n            transitionToScanning();\n            return;\n        }\n        this.renderedCamera.resume(function () {\n            transitionToScanning();\n        });\n    };\n    Html5Qrcode.prototype.getState = function () {\n        return this.stateManagerProxy.getState();\n    };\n    Html5Qrcode.prototype.stop = function () {\n        var _this = this;\n        if (!this.stateManagerProxy.isScanning()) {\n            throw \"Cannot stop, scanner is not running or paused.\";\n        }\n        var toStoppedStateTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);\n        this.shouldScan = false;\n        if (this.foreverScanTimeout) {\n            clearTimeout(this.foreverScanTimeout);\n        }\n        var removeQrRegion = function () {\n            if (!_this.element) {\n                return;\n            }\n            var childElement = document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);\n            if (childElement) {\n                _this.element.removeChild(childElement);\n            }\n        };\n        var $this = this;\n        return this.renderedCamera.close().then(function () {\n            $this.renderedCamera = null;\n            if ($this.element) {\n                $this.element.removeChild($this.canvasElement);\n                $this.canvasElement = null;\n            }\n            removeQrRegion();\n            if ($this.qrRegion) {\n                $this.qrRegion = null;\n            }\n            if ($this.context) {\n                $this.context = null;\n            }\n            toStoppedStateTransaction.execute();\n            $this.hidePausedState();\n            $this.isScanning = false;\n            return Promise.resolve();\n        });\n    };\n    Html5Qrcode.prototype.scanFile = function (imageFile, showImage) {\n        return this.scanFileV2(imageFile, showImage)\n            .then(function (html5qrcodeResult) { return html5qrcodeResult.decodedText; });\n    };\n    Html5Qrcode.prototype.scanFileV2 = function (imageFile, showImage) {\n        var _this = this;\n        if (!imageFile || !(imageFile instanceof File)) {\n            throw \"imageFile argument is mandatory and should be instance \"\n                + \"of File. Use 'event.target.files[0]'.\";\n        }\n        if (isNullOrUndefined(showImage)) {\n            showImage = true;\n        }\n        if (!this.stateManagerProxy.canScanFile()) {\n            throw \"Cannot start file scan - ongoing camera scan\";\n        }\n        return new Promise(function (resolve, reject) {\n            _this.possiblyCloseLastScanImageFile();\n            _this.clearElement();\n            _this.lastScanImageFile = URL.createObjectURL(imageFile);\n            var inputImage = new Image;\n            inputImage.onload = function () {\n                var imageWidth = inputImage.width;\n                var imageHeight = inputImage.height;\n                var element = document.getElementById(_this.elementId);\n                var containerWidth = element.clientWidth\n                    ? element.clientWidth : Constants.DEFAULT_WIDTH;\n                var containerHeight = Math.max(element.clientHeight ? element.clientHeight : imageHeight, Constants.FILE_SCAN_MIN_HEIGHT);\n                var config = _this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n                if (showImage) {\n                    var visibleCanvas = _this.createCanvasElement(containerWidth, containerHeight, \"qr-canvas-visible\");\n                    visibleCanvas.style.display = \"inline-block\";\n                    element.appendChild(visibleCanvas);\n                    var context_1 = visibleCanvas.getContext(\"2d\");\n                    if (!context_1) {\n                        throw \"Unable to get 2d context from canvas\";\n                    }\n                    context_1.canvas.width = containerWidth;\n                    context_1.canvas.height = containerHeight;\n                    context_1.drawImage(inputImage, 0, 0, imageWidth, imageHeight, config.x, config.y, config.width, config.height);\n                }\n                var padding = Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING;\n                var hiddenImageWidth = Math.max(inputImage.width, config.width);\n                var hiddenImageHeight = Math.max(inputImage.height, config.height);\n                var hiddenCanvasWidth = hiddenImageWidth + 2 * padding;\n                var hiddenCanvasHeight = hiddenImageHeight + 2 * padding;\n                var hiddenCanvas = _this.createCanvasElement(hiddenCanvasWidth, hiddenCanvasHeight);\n                element.appendChild(hiddenCanvas);\n                var context = hiddenCanvas.getContext(\"2d\");\n                if (!context) {\n                    throw \"Unable to get 2d context from canvas\";\n                }\n                context.canvas.width = hiddenCanvasWidth;\n                context.canvas.height = hiddenCanvasHeight;\n                context.drawImage(inputImage, 0, 0, imageWidth, imageHeight, padding, padding, hiddenImageWidth, hiddenImageHeight);\n                try {\n                    _this.qrcode.decodeRobustlyAsync(hiddenCanvas)\n                        .then(function (result) {\n                        resolve(Html5QrcodeResultFactory.createFromQrcodeResult(result));\n                    })\n                        .catch(reject);\n                }\n                catch (exception) {\n                    reject(\"QR code parse error, error = \".concat(exception));\n                }\n            };\n            inputImage.onerror = reject;\n            inputImage.onabort = reject;\n            inputImage.onstalled = reject;\n            inputImage.onsuspend = reject;\n            inputImage.src = URL.createObjectURL(imageFile);\n        });\n    };\n    Html5Qrcode.prototype.clear = function () {\n        this.clearElement();\n    };\n    Html5Qrcode.getCameras = function () {\n        return CameraRetriever.retrieve();\n    };\n    Html5Qrcode.prototype.getRunningTrackCapabilities = function () {\n        return this.getRenderedCameraOrFail().getRunningTrackCapabilities();\n    };\n    Html5Qrcode.prototype.getRunningTrackSettings = function () {\n        return this.getRenderedCameraOrFail().getRunningTrackSettings();\n    };\n    Html5Qrcode.prototype.getRunningTrackCameraCapabilities = function () {\n        return this.getRenderedCameraOrFail().getCapabilities();\n    };\n    Html5Qrcode.prototype.applyVideoConstraints = function (videoConstaints) {\n        if (!videoConstaints) {\n            throw \"videoConstaints is required argument.\";\n        }\n        else if (!VideoConstraintsUtil.isMediaStreamConstraintsValid(videoConstaints, this.logger)) {\n            throw \"invalid videoConstaints passed, check logs for more details\";\n        }\n        return this.getRenderedCameraOrFail().applyVideoConstraints(videoConstaints);\n    };\n    Html5Qrcode.prototype.getRenderedCameraOrFail = function () {\n        if (this.renderedCamera == null) {\n            throw \"Scanning is not in running state, call this API only when\"\n                + \" QR code scanning using camera is in running state.\";\n        }\n        return this.renderedCamera;\n    };\n    Html5Qrcode.prototype.getSupportedFormats = function (configOrVerbosityFlag) {\n        var allFormats = [\n            Html5QrcodeSupportedFormats.QR_CODE,\n            Html5QrcodeSupportedFormats.AZTEC,\n            Html5QrcodeSupportedFormats.CODABAR,\n            Html5QrcodeSupportedFormats.CODE_39,\n            Html5QrcodeSupportedFormats.CODE_93,\n            Html5QrcodeSupportedFormats.CODE_128,\n            Html5QrcodeSupportedFormats.DATA_MATRIX,\n            Html5QrcodeSupportedFormats.MAXICODE,\n            Html5QrcodeSupportedFormats.ITF,\n            Html5QrcodeSupportedFormats.EAN_13,\n            Html5QrcodeSupportedFormats.EAN_8,\n            Html5QrcodeSupportedFormats.PDF_417,\n            Html5QrcodeSupportedFormats.RSS_14,\n            Html5QrcodeSupportedFormats.RSS_EXPANDED,\n            Html5QrcodeSupportedFormats.UPC_A,\n            Html5QrcodeSupportedFormats.UPC_E,\n            Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION,\n        ];\n        if (!configOrVerbosityFlag\n            || typeof configOrVerbosityFlag == \"boolean\") {\n            return allFormats;\n        }\n        if (!configOrVerbosityFlag.formatsToSupport) {\n            return allFormats;\n        }\n        if (!Array.isArray(configOrVerbosityFlag.formatsToSupport)) {\n            throw \"configOrVerbosityFlag.formatsToSupport should be undefined \"\n                + \"or an array.\";\n        }\n        if (configOrVerbosityFlag.formatsToSupport.length === 0) {\n            throw \"Atleast 1 formatsToSupport is needed.\";\n        }\n        var supportedFormats = [];\n        for (var _i = 0, _a = configOrVerbosityFlag.formatsToSupport; _i < _a.length; _i++) {\n            var format = _a[_i];\n            if (isValidHtml5QrcodeSupportedFormats(format)) {\n                supportedFormats.push(format);\n            }\n            else {\n                this.logger.warn(\"Invalid format: \".concat(format, \" passed in config, ignoring.\"));\n            }\n        }\n        if (supportedFormats.length === 0) {\n            throw \"None of formatsToSupport match supported values.\";\n        }\n        return supportedFormats;\n    };\n    Html5Qrcode.prototype.getUseBarCodeDetectorIfSupported = function (config) {\n        if (isNullOrUndefined(config)) {\n            return true;\n        }\n        if (!isNullOrUndefined(config.useBarCodeDetectorIfSupported)) {\n            return config.useBarCodeDetectorIfSupported !== false;\n        }\n        if (isNullOrUndefined(config.experimentalFeatures)) {\n            return true;\n        }\n        var experimentalFeatures = config.experimentalFeatures;\n        if (isNullOrUndefined(experimentalFeatures.useBarCodeDetectorIfSupported)) {\n            return true;\n        }\n        return experimentalFeatures.useBarCodeDetectorIfSupported !== false;\n    };\n    Html5Qrcode.prototype.validateQrboxSize = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n        var _this = this;\n        var qrboxSize = internalConfig.qrbox;\n        this.validateQrboxConfig(qrboxSize);\n        var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n        var validateMinSize = function (size) {\n            if (size < Constants.MIN_QR_BOX_SIZE) {\n                throw \"minimum size of 'config.qrbox' dimension value is\"\n                    + \" \".concat(Constants.MIN_QR_BOX_SIZE, \"px.\");\n            }\n        };\n        var correctWidthBasedOnRootElementSize = function (configWidth) {\n            if (configWidth > viewfinderWidth) {\n                _this.logger.warn(\"`qrbox.width` or `qrbox` is larger than the\"\n                    + \" width of the root element. The width will be truncated\"\n                    + \" to the width of root element.\");\n                configWidth = viewfinderWidth;\n            }\n            return configWidth;\n        };\n        validateMinSize(qrDimensions.width);\n        validateMinSize(qrDimensions.height);\n        qrDimensions.width = correctWidthBasedOnRootElementSize(qrDimensions.width);\n    };\n    Html5Qrcode.prototype.validateQrboxConfig = function (qrboxSize) {\n        if (typeof qrboxSize === \"number\") {\n            return;\n        }\n        if (typeof qrboxSize === \"function\") {\n            return;\n        }\n        if (qrboxSize.width === undefined || qrboxSize.height === undefined) {\n            throw \"Invalid instance of QrDimensions passed for \"\n                + \"'config.qrbox'. Both 'width' and 'height' should be set.\";\n        }\n    };\n    Html5Qrcode.prototype.toQrdimensions = function (viewfinderWidth, viewfinderHeight, qrboxSize) {\n        if (typeof qrboxSize === \"number\") {\n            return { width: qrboxSize, height: qrboxSize };\n        }\n        else if (typeof qrboxSize === \"function\") {\n            try {\n                return qrboxSize(viewfinderWidth, viewfinderHeight);\n            }\n            catch (error) {\n                throw new Error(\"qrbox config was passed as a function but it failed with \"\n                    + \"unknown error\" + error);\n            }\n        }\n        return qrboxSize;\n    };\n    Html5Qrcode.prototype.setupUi = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n        if (internalConfig.isShadedBoxEnabled()) {\n            this.validateQrboxSize(viewfinderWidth, viewfinderHeight, internalConfig);\n        }\n        var qrboxSize = isNullOrUndefined(internalConfig.qrbox) ?\n            { width: viewfinderWidth, height: viewfinderHeight } : internalConfig.qrbox;\n        this.validateQrboxConfig(qrboxSize);\n        var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n        if (qrDimensions.height > viewfinderHeight) {\n            this.logger.warn(\"[Html5Qrcode] config.qrbox has height that is\"\n                + \"greater than the height of the video stream. Shading will be\"\n                + \" ignored\");\n        }\n        var shouldShadingBeApplied = internalConfig.isShadedBoxEnabled()\n            && qrDimensions.height <= viewfinderHeight;\n        var defaultQrRegion = {\n            x: 0,\n            y: 0,\n            width: viewfinderWidth,\n            height: viewfinderHeight\n        };\n        var qrRegion = shouldShadingBeApplied\n            ? this.getShadedRegionBounds(viewfinderWidth, viewfinderHeight, qrDimensions)\n            : defaultQrRegion;\n        var canvasElement = this.createCanvasElement(qrRegion.width, qrRegion.height);\n        var contextAttributes = { willReadFrequently: true };\n        var context = canvasElement.getContext(\"2d\", contextAttributes);\n        context.canvas.width = qrRegion.width;\n        context.canvas.height = qrRegion.height;\n        this.element.append(canvasElement);\n        if (shouldShadingBeApplied) {\n            this.possiblyInsertShadingElement(this.element, viewfinderWidth, viewfinderHeight, qrDimensions);\n        }\n        this.createScannerPausedUiElement(this.element);\n        this.qrRegion = qrRegion;\n        this.context = context;\n        this.canvasElement = canvasElement;\n    };\n    Html5Qrcode.prototype.createScannerPausedUiElement = function (rootElement) {\n        var scannerPausedUiElement = document.createElement(\"div\");\n        scannerPausedUiElement.innerText = Html5QrcodeStrings.scannerPaused();\n        scannerPausedUiElement.style.display = \"none\";\n        scannerPausedUiElement.style.position = \"absolute\";\n        scannerPausedUiElement.style.top = \"0px\";\n        scannerPausedUiElement.style.zIndex = \"1\";\n        scannerPausedUiElement.style.background = \"rgba(9, 9, 9, 0.46)\";\n        scannerPausedUiElement.style.color = \"#FFECEC\";\n        scannerPausedUiElement.style.textAlign = \"center\";\n        scannerPausedUiElement.style.width = \"100%\";\n        rootElement.appendChild(scannerPausedUiElement);\n        this.scannerPausedUiElement = scannerPausedUiElement;\n    };\n    Html5Qrcode.prototype.scanContext = function (qrCodeSuccessCallback, qrCodeErrorCallback) {\n        var _this = this;\n        if (this.stateManagerProxy.isPaused()) {\n            return Promise.resolve(false);\n        }\n        return this.qrcode.decodeAsync(this.canvasElement)\n            .then(function (result) {\n            qrCodeSuccessCallback(result.text, Html5QrcodeResultFactory.createFromQrcodeResult(result));\n            _this.possiblyUpdateShaders(true);\n            return true;\n        }).catch(function (error) {\n            _this.possiblyUpdateShaders(false);\n            var errorMessage = Html5QrcodeStrings.codeParseError(error);\n            qrCodeErrorCallback(errorMessage, Html5QrcodeErrorFactory.createFrom(errorMessage));\n            return false;\n        });\n    };\n    Html5Qrcode.prototype.foreverScan = function (internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback) {\n        var _this = this;\n        if (!this.shouldScan) {\n            return;\n        }\n        if (!this.renderedCamera) {\n            return;\n        }\n        var videoElement = this.renderedCamera.getSurface();\n        var widthRatio = videoElement.videoWidth / videoElement.clientWidth;\n        var heightRatio = videoElement.videoHeight / videoElement.clientHeight;\n        if (!this.qrRegion) {\n            throw \"qrRegion undefined when localMediaStream is ready.\";\n        }\n        var sWidthOffset = this.qrRegion.width * widthRatio;\n        var sHeightOffset = this.qrRegion.height * heightRatio;\n        var sxOffset = this.qrRegion.x * widthRatio;\n        var syOffset = this.qrRegion.y * heightRatio;\n        this.context.drawImage(videoElement, sxOffset, syOffset, sWidthOffset, sHeightOffset, 0, 0, this.qrRegion.width, this.qrRegion.height);\n        var triggerNextScan = function () {\n            _this.foreverScanTimeout = setTimeout(function () {\n                _this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback);\n            }, _this.getTimeoutFps(internalConfig.fps));\n        };\n        this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback)\n            .then(function (isSuccessfull) {\n            if (!isSuccessfull && internalConfig.disableFlip !== true) {\n                _this.context.translate(_this.context.canvas.width, 0);\n                _this.context.scale(-1, 1);\n                _this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback)\n                    .finally(function () {\n                    triggerNextScan();\n                });\n            }\n            else {\n                triggerNextScan();\n            }\n        }).catch(function (error) {\n            _this.logger.logError(\"Error happend while scanning context\", error);\n            triggerNextScan();\n        });\n    };\n    Html5Qrcode.prototype.createVideoConstraints = function (cameraIdOrConfig) {\n        if (typeof cameraIdOrConfig == \"string\") {\n            return { deviceId: { exact: cameraIdOrConfig } };\n        }\n        else if (typeof cameraIdOrConfig == \"object\") {\n            var facingModeKey = \"facingMode\";\n            var deviceIdKey = \"deviceId\";\n            var allowedFacingModeValues_1 = { \"user\": true, \"environment\": true };\n            var exactKey = \"exact\";\n            var isValidFacingModeValue = function (value) {\n                if (value in allowedFacingModeValues_1) {\n                    return true;\n                }\n                else {\n                    throw \"config has invalid 'facingMode' value = \"\n                        + \"'\".concat(value, \"'\");\n                }\n            };\n            var keys = Object.keys(cameraIdOrConfig);\n            if (keys.length !== 1) {\n                throw \"'cameraIdOrConfig' object should have exactly 1 key,\"\n                    + \" if passed as an object, found \".concat(keys.length, \" keys\");\n            }\n            var key = Object.keys(cameraIdOrConfig)[0];\n            if (key !== facingModeKey && key !== deviceIdKey) {\n                throw \"Only '\".concat(facingModeKey, \"' and '\").concat(deviceIdKey, \"' \")\n                    + \" are supported for 'cameraIdOrConfig'\";\n            }\n            if (key === facingModeKey) {\n                var facingMode = cameraIdOrConfig.facingMode;\n                if (typeof facingMode == \"string\") {\n                    if (isValidFacingModeValue(facingMode)) {\n                        return { facingMode: facingMode };\n                    }\n                }\n                else if (typeof facingMode == \"object\") {\n                    if (exactKey in facingMode) {\n                        if (isValidFacingModeValue(facingMode[\"\".concat(exactKey)])) {\n                            return {\n                                facingMode: {\n                                    exact: facingMode[\"\".concat(exactKey)]\n                                }\n                            };\n                        }\n                    }\n                    else {\n                        throw \"'facingMode' should be string or object with\"\n                            + \" \".concat(exactKey, \" as key.\");\n                    }\n                }\n                else {\n                    var type_1 = (typeof facingMode);\n                    throw \"Invalid type of 'facingMode' = \".concat(type_1);\n                }\n            }\n            else {\n                var deviceId = cameraIdOrConfig.deviceId;\n                if (typeof deviceId == \"string\") {\n                    return { deviceId: deviceId };\n                }\n                else if (typeof deviceId == \"object\") {\n                    if (exactKey in deviceId) {\n                        return {\n                            deviceId: { exact: deviceId[\"\".concat(exactKey)] }\n                        };\n                    }\n                    else {\n                        throw \"'deviceId' should be string or object with\"\n                            + \" \".concat(exactKey, \" as key.\");\n                    }\n                }\n                else {\n                    var type_2 = (typeof deviceId);\n                    throw \"Invalid type of 'deviceId' = \".concat(type_2);\n                }\n            }\n        }\n        var type = (typeof cameraIdOrConfig);\n        throw \"Invalid type of 'cameraIdOrConfig' = \".concat(type);\n    };\n    Html5Qrcode.prototype.computeCanvasDrawConfig = function (imageWidth, imageHeight, containerWidth, containerHeight) {\n        if (imageWidth <= containerWidth\n            && imageHeight <= containerHeight) {\n            var xoffset = (containerWidth - imageWidth) / 2;\n            var yoffset = (containerHeight - imageHeight) / 2;\n            return {\n                x: xoffset,\n                y: yoffset,\n                width: imageWidth,\n                height: imageHeight\n            };\n        }\n        else {\n            var formerImageWidth = imageWidth;\n            var formerImageHeight = imageHeight;\n            if (imageWidth > containerWidth) {\n                imageHeight = (containerWidth / imageWidth) * imageHeight;\n                imageWidth = containerWidth;\n            }\n            if (imageHeight > containerHeight) {\n                imageWidth = (containerHeight / imageHeight) * imageWidth;\n                imageHeight = containerHeight;\n            }\n            this.logger.log(\"Image downsampled from \"\n                + \"\".concat(formerImageWidth, \"X\").concat(formerImageHeight)\n                + \" to \".concat(imageWidth, \"X\").concat(imageHeight, \".\"));\n            return this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n        }\n    };\n    Html5Qrcode.prototype.clearElement = function () {\n        if (this.stateManagerProxy.isScanning()) {\n            throw \"Cannot clear while scan is ongoing, close it first.\";\n        }\n        var element = document.getElementById(this.elementId);\n        if (element) {\n            element.innerHTML = \"\";\n        }\n    };\n    Html5Qrcode.prototype.possiblyUpdateShaders = function (qrMatch) {\n        if (this.qrMatch === qrMatch) {\n            return;\n        }\n        if (this.hasBorderShaders\n            && this.borderShaders\n            && this.borderShaders.length) {\n            this.borderShaders.forEach(function (shader) {\n                shader.style.backgroundColor = qrMatch\n                    ? Constants.BORDER_SHADER_MATCH_COLOR\n                    : Constants.BORDER_SHADER_DEFAULT_COLOR;\n            });\n        }\n        this.qrMatch = qrMatch;\n    };\n    Html5Qrcode.prototype.possiblyCloseLastScanImageFile = function () {\n        if (this.lastScanImageFile) {\n            URL.revokeObjectURL(this.lastScanImageFile);\n            this.lastScanImageFile = null;\n        }\n    };\n    Html5Qrcode.prototype.createCanvasElement = function (width, height, customId) {\n        var canvasWidth = width;\n        var canvasHeight = height;\n        var canvasElement = document.createElement(\"canvas\");\n        canvasElement.style.width = \"\".concat(canvasWidth, \"px\");\n        canvasElement.style.height = \"\".concat(canvasHeight, \"px\");\n        canvasElement.style.display = \"none\";\n        canvasElement.id = isNullOrUndefined(customId)\n            ? \"qr-canvas\" : customId;\n        return canvasElement;\n    };\n    Html5Qrcode.prototype.getShadedRegionBounds = function (width, height, qrboxSize) {\n        if (qrboxSize.width > width || qrboxSize.height > height) {\n            throw \"'config.qrbox' dimensions should not be greater than the \"\n                + \"dimensions of the root HTML element.\";\n        }\n        return {\n            x: (width - qrboxSize.width) / 2,\n            y: (height - qrboxSize.height) / 2,\n            width: qrboxSize.width,\n            height: qrboxSize.height\n        };\n    };\n    Html5Qrcode.prototype.possiblyInsertShadingElement = function (element, width, height, qrboxSize) {\n        if ((width - qrboxSize.width) < 1 || (height - qrboxSize.height) < 1) {\n            return;\n        }\n        var shadingElement = document.createElement(\"div\");\n        shadingElement.style.position = \"absolute\";\n        var rightLeftBorderSize = (width - qrboxSize.width) / 2;\n        var topBottomBorderSize = (height - qrboxSize.height) / 2;\n        shadingElement.style.borderLeft\n            = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.borderRight\n            = \"\".concat(rightLeftBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.borderTop\n            = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.borderBottom\n            = \"\".concat(topBottomBorderSize, \"px solid rgba(0, 0, 0, 0.48)\");\n        shadingElement.style.boxSizing = \"border-box\";\n        shadingElement.style.top = \"0px\";\n        shadingElement.style.bottom = \"0px\";\n        shadingElement.style.left = \"0px\";\n        shadingElement.style.right = \"0px\";\n        shadingElement.id = \"\".concat(Constants.SHADED_REGION_ELEMENT_ID);\n        if ((width - qrboxSize.width) < 11\n            || (height - qrboxSize.height) < 11) {\n            this.hasBorderShaders = false;\n        }\n        else {\n            var smallSize = 5;\n            var largeSize = 40;\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, true);\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, null, 0, false);\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, true);\n            this.insertShaderBorders(shadingElement, largeSize, smallSize, null, -smallSize, 0, false);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, true);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, true);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, null, -smallSize, false);\n            this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, null, -smallSize, -smallSize, false);\n            this.hasBorderShaders = true;\n        }\n        element.append(shadingElement);\n    };\n    Html5Qrcode.prototype.insertShaderBorders = function (shaderElem, width, height, top, bottom, side, isLeft) {\n        var elem = document.createElement(\"div\");\n        elem.style.position = \"absolute\";\n        elem.style.backgroundColor = Constants.BORDER_SHADER_DEFAULT_COLOR;\n        elem.style.width = \"\".concat(width, \"px\");\n        elem.style.height = \"\".concat(height, \"px\");\n        if (top !== null) {\n            elem.style.top = \"\".concat(top, \"px\");\n        }\n        if (bottom !== null) {\n            elem.style.bottom = \"\".concat(bottom, \"px\");\n        }\n        if (isLeft) {\n            elem.style.left = \"\".concat(side, \"px\");\n        }\n        else {\n            elem.style.right = \"\".concat(side, \"px\");\n        }\n        if (!this.borderShaders) {\n            this.borderShaders = [];\n        }\n        this.borderShaders.push(elem);\n        shaderElem.appendChild(elem);\n    };\n    Html5Qrcode.prototype.showPausedState = function () {\n        if (!this.scannerPausedUiElement) {\n            throw \"[internal error] scanner paused UI element not found\";\n        }\n        this.scannerPausedUiElement.style.display = \"block\";\n    };\n    Html5Qrcode.prototype.hidePausedState = function () {\n        if (!this.scannerPausedUiElement) {\n            throw \"[internal error] scanner paused UI element not found\";\n        }\n        this.scannerPausedUiElement.style.display = \"none\";\n    };\n    Html5Qrcode.prototype.getTimeoutFps = function (fps) {\n        return 1000 / fps;\n    };\n    return Html5Qrcode;\n}());\nexport { Html5Qrcode };\n//# sourceMappingURL=html5-qrcode.js.map"]},"metadata":{},"sourceType":"module"}