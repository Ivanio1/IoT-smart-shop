{"ast":null,"code":"var _jsxFileName = \"/home/ivan/IdeaProjects/tpo1/vk-auth-react-nestjs/frontend/src/components/VKButton/index.tsx\";\nimport React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport { isEmptyObj } from \"helpers/isEmptyObj\";\nimport UserStore from \"stores/UserStore\";\nimport vk from \"./img/VK_Blue_Logo.svg\";\nimport styles from \"./VKButton.module.scss\";\n\nconst VKButton = props => {\n  const [isError, setIsError] = React.useState(false);\n  const host = process.env.REACT_APP_MODE === \"production\" ? process.env.REACT_APP_HOST_PROD : process.env.REACT_APP_HOST_LOCAL;\n  const cbLink = `${host}/signin`;\n\n  const handleRedirect = () => {\n    window.location.href = `https://oauth.vk.com/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&display=popup&redirect_uri=${cbLink}&scope=email&response_type=code&v=5.120&state=4194308`;\n  };\n\n  React.useEffect(() => {\n    const handleLogin = code => {\n      UserStore.loginVk(code).then(() => {\n        props.history.push(\"/user\");\n      }).catch(() => setIsError(true));\n    };\n\n    let queryObj = queryString.parse(props.location.search);\n    if (isError) window.location.href = cbLink;\n    if (!isEmptyObj(queryObj) && queryObj[\"code\"]) handleLogin(queryObj.code);\n  }, [props.location.search, isError, cbLink, props.history]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles[\"vk-button\"],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: styles[\"vk-button__input\"],\n    onClick: handleRedirect,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: vk,\n    alt: \"vk logo\",\n    className: styles[\"vk-button__input-icon\"],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 9\n    }\n  }), \"\\u0412\\u043E\\u0439\\u0442\\u0438 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0412\\u043A\\u043E\\u043D\\u0442\\u0430\\u043A\\u0442\\u0435\"), isError && /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"red\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 19\n    }\n  }, \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432\\u0445\\u043E\\u0434\\u0430 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0412\\u041A\"));\n};\n\nexport default withRouter(VKButton);","map":{"version":3,"sources":["/home/ivan/IdeaProjects/tpo1/vk-auth-react-nestjs/frontend/src/components/VKButton/index.tsx"],"names":["React","withRouter","queryString","isEmptyObj","UserStore","styles","VKButton","props","isError","setIsError","useState","host","process","env","REACT_APP_MODE","REACT_APP_HOST_PROD","REACT_APP_HOST_LOCAL","cbLink","handleRedirect","window","location","href","REACT_APP_CLIENT_ID","useEffect","handleLogin","code","loginVk","then","history","push","catch","queryObj","parse","search","vk","color"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,UAAT,QAAgD,kBAAhD;AACA,OAAOC,WAAP,MAAwB,cAAxB;AAEA,SAASC,UAAT,QAA2B,oBAA3B;AACA,OAAOC,SAAP,MAAsB,kBAAtB;;AAIA,OAAOC,MAAP,MAAmB,wBAAnB;;AAIA,MAAMC,QAA0B,GAAIC,KAAD,IAAW;AAC5C,QAAM,CAACC,OAAD,EAAUC,UAAV,IAAwBT,KAAK,CAACU,QAAN,CAAe,KAAf,CAA9B;AAEA,QAAMC,IAAI,GACRC,OAAO,CAACC,GAAR,CAAYC,cAAZ,KAA+B,YAA/B,GACIF,OAAO,CAACC,GAAR,CAAYE,mBADhB,GAEIH,OAAO,CAACC,GAAR,CAAYG,oBAHlB;AAKA,QAAMC,MAAM,GAAI,GAAEN,IAAK,SAAvB;;AAEA,QAAMO,cAAc,GAAG,MAAM;AAC3BC,IAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAwB,4CAA2CT,OAAO,CAACC,GAAR,CAAYS,mBAAoB,+BAA8BL,MAAO,uDAAxI;AACD,GAFD;;AAIAjB,EAAAA,KAAK,CAACuB,SAAN,CAAgB,MAAM;AACpB,UAAMC,WAAW,GAAIC,IAAD,IAAkB;AACpCrB,MAAAA,SAAS,CAACsB,OAAV,CAAkBD,IAAlB,EACGE,IADH,CACQ,MAAM;AACVpB,QAAAA,KAAK,CAACqB,OAAN,CAAcC,IAAd,CAAmB,OAAnB;AACD,OAHH,EAIGC,KAJH,CAIS,MAAMrB,UAAU,CAAC,IAAD,CAJzB;AAKD,KAND;;AAQA,QAAIsB,QAAQ,GAAG7B,WAAW,CAAC8B,KAAZ,CAAkBzB,KAAK,CAACa,QAAN,CAAea,MAAjC,CAAf;AAEA,QAAIzB,OAAJ,EAAaW,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuBJ,MAAvB;AAEb,QAAI,CAACd,UAAU,CAAC4B,QAAD,CAAX,IAAyBA,QAAQ,CAAC,MAAD,CAArC,EAA+CP,WAAW,CAACO,QAAQ,CAACN,IAAV,CAAX;AAChD,GAdD,EAcG,CAAClB,KAAK,CAACa,QAAN,CAAea,MAAhB,EAAwBzB,OAAxB,EAAiCS,MAAjC,EAAyCV,KAAK,CAACqB,OAA/C,CAdH;AAgBA,sBACE;AAAK,IAAA,SAAS,EAAEvB,MAAM,CAAC,WAAD,CAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAQ,IAAA,SAAS,EAAEA,MAAM,CAAC,kBAAD,CAAzB;AAA+C,IAAA,OAAO,EAAEa,cAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AACE,IAAA,GAAG,EAAEgB,EADP;AAEE,IAAA,GAAG,EAAC,SAFN;AAGE,IAAA,SAAS,EAAE7B,MAAM,CAAC,uBAAD,CAHnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,yHADF,EASGG,OAAO,iBAAI;AAAG,IAAA,KAAK,EAAE;AAAE2B,MAAAA,KAAK,EAAE;AAAT,KAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uHATd,CADF;AAaD,CA3CD;;AA6CA,eAAelC,UAAU,CAACK,QAAD,CAAzB","sourcesContent":["import React from \"react\";\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\nimport queryString from \"query-string\";\n\nimport { isEmptyObj } from \"helpers/isEmptyObj\";\nimport UserStore from \"stores/UserStore\";\n\nimport vk from \"./img/VK_Blue_Logo.svg\";\n\nimport styles from \"./VKButton.module.scss\";\n\ninterface IProps extends RouteComponentProps {}\n\nconst VKButton: React.FC<IProps> = (props) => {\n  const [isError, setIsError] = React.useState(false);\n\n  const host =\n    process.env.REACT_APP_MODE === \"production\"\n      ? process.env.REACT_APP_HOST_PROD\n      : process.env.REACT_APP_HOST_LOCAL;\n\n  const cbLink = `${host}/signin`;\n\n  const handleRedirect = () => {\n    window.location.href = `https://oauth.vk.com/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&display=popup&redirect_uri=${cbLink}&scope=email&response_type=code&v=5.120&state=4194308`;\n  };\n\n  React.useEffect(() => {\n    const handleLogin = (code: string) => {\n      UserStore.loginVk(code)\n        .then(() => {\n          props.history.push(\"/user\");\n        })\n        .catch(() => setIsError(true));\n    };\n\n    let queryObj = queryString.parse(props.location.search);\n\n    if (isError) window.location.href = cbLink;\n\n    if (!isEmptyObj(queryObj) && queryObj[\"code\"]) handleLogin(queryObj.code);\n  }, [props.location.search, isError, cbLink, props.history]);\n\n  return (\n    <div className={styles[\"vk-button\"]}>\n      <button className={styles[\"vk-button__input\"]} onClick={handleRedirect}>\n        <img\n          src={vk}\n          alt=\"vk logo\"\n          className={styles[\"vk-button__input-icon\"]}\n        />\n        Войти через Вконтакте\n      </button>\n      {isError && <p style={{ color: \"red\" }}>Ошибка входа через ВК</p>}\n    </div>\n  );\n};\n\nexport default withRouter(VKButton);\n"]},"metadata":{},"sourceType":"module"}