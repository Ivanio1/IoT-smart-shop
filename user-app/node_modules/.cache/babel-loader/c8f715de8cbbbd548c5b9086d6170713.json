{"ast":null,"code":"import { Html5QrcodeConstants, Html5QrcodeScanType, Html5QrcodeErrorFactory, BaseLoggger, isNullOrUndefined, clip } from \"./core\";\nimport { Html5Qrcode } from \"./html5-qrcode\";\nimport { Html5QrcodeScannerStrings } from \"./strings\";\nimport { ASSET_FILE_SCAN, ASSET_CAMERA_SCAN } from \"./image-assets\";\nimport { PersistedDataManager } from \"./storage\";\nimport { LibraryInfoContainer } from \"./ui\";\nimport { CameraPermissions } from \"./camera/permissions\";\nimport { ScanTypeSelector } from \"./ui/scanner/scan-type-selector\";\nimport { TorchButton } from \"./ui/scanner/torch-button\";\nimport { FileSelectionUi } from \"./ui/scanner/file-selection-ui\";\nimport { BaseUiElementFactory, PublicUiElementIdAndClasses } from \"./ui/scanner/base\";\nimport { CameraSelectionUi } from \"./ui/scanner/camera-selection-ui\";\nimport { CameraZoomUi } from \"./ui/scanner/camera-zoom-ui\";\nvar Html5QrcodeScannerStatus;\n\n(function (Html5QrcodeScannerStatus) {\n  Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_DEFAULT\"] = 0] = \"STATUS_DEFAULT\";\n  Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_SUCCESS\"] = 1] = \"STATUS_SUCCESS\";\n  Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_WARNING\"] = 2] = \"STATUS_WARNING\";\n  Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_REQUESTING_PERMISSION\"] = 3] = \"STATUS_REQUESTING_PERMISSION\";\n})(Html5QrcodeScannerStatus || (Html5QrcodeScannerStatus = {}));\n\nfunction toHtml5QrcodeCameraScanConfig(config) {\n  return {\n    fps: config.fps,\n    qrbox: config.qrbox,\n    aspectRatio: config.aspectRatio,\n    disableFlip: config.disableFlip,\n    videoConstraints: config.videoConstraints\n  };\n}\n\nfunction toHtml5QrcodeFullConfig(config, verbose) {\n  return {\n    formatsToSupport: config.formatsToSupport,\n    useBarCodeDetectorIfSupported: config.useBarCodeDetectorIfSupported,\n    experimentalFeatures: config.experimentalFeatures,\n    verbose: verbose\n  };\n}\n\nvar Html5QrcodeScanner = function () {\n  function Html5QrcodeScanner(elementId, config, verbose) {\n    this.lastMatchFound = null;\n    this.cameraScanImage = null;\n    this.fileScanImage = null;\n    this.fileSelectionUi = null;\n    this.elementId = elementId;\n    this.config = this.createConfig(config);\n    this.verbose = verbose === true;\n\n    if (!document.getElementById(elementId)) {\n      throw \"HTML Element with id=\".concat(elementId, \" not found\");\n    }\n\n    this.scanTypeSelector = new ScanTypeSelector(this.config.supportedScanTypes);\n    this.currentScanType = this.scanTypeSelector.getDefaultScanType();\n    this.sectionSwapAllowed = true;\n    this.logger = new BaseLoggger(this.verbose);\n    this.persistedDataManager = new PersistedDataManager();\n\n    if (config.rememberLastUsedCamera !== true) {\n      this.persistedDataManager.reset();\n    }\n  }\n\n  Html5QrcodeScanner.prototype.render = function (qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n\n    this.lastMatchFound = null;\n\n    this.qrCodeSuccessCallback = function (decodedText, result) {\n      if (qrCodeSuccessCallback) {\n        qrCodeSuccessCallback(decodedText, result);\n      } else {\n        if (_this.lastMatchFound === decodedText) {\n          return;\n        }\n\n        _this.lastMatchFound = decodedText;\n\n        _this.setHeaderMessage(Html5QrcodeScannerStrings.lastMatch(decodedText), Html5QrcodeScannerStatus.STATUS_SUCCESS);\n      }\n    };\n\n    this.qrCodeErrorCallback = function (errorMessage, error) {\n      if (qrCodeErrorCallback) {\n        qrCodeErrorCallback(errorMessage, error);\n      }\n    };\n\n    var container = document.getElementById(this.elementId);\n\n    if (!container) {\n      throw \"HTML Element with id=\".concat(this.elementId, \" not found\");\n    }\n\n    container.innerHTML = \"\";\n    this.createBasicLayout(container);\n    this.html5Qrcode = new Html5Qrcode(this.getScanRegionId(), toHtml5QrcodeFullConfig(this.config, this.verbose));\n  };\n\n  Html5QrcodeScanner.prototype.pause = function (shouldPauseVideo) {\n    if (isNullOrUndefined(shouldPauseVideo) || shouldPauseVideo !== true) {\n      shouldPauseVideo = false;\n    }\n\n    this.getHtml5QrcodeOrFail().pause(shouldPauseVideo);\n  };\n\n  Html5QrcodeScanner.prototype.resume = function () {\n    this.getHtml5QrcodeOrFail().resume();\n  };\n\n  Html5QrcodeScanner.prototype.getState = function () {\n    return this.getHtml5QrcodeOrFail().getState();\n  };\n\n  Html5QrcodeScanner.prototype.clear = function () {\n    var _this = this;\n\n    var emptyHtmlContainer = function () {\n      var mainContainer = document.getElementById(_this.elementId);\n\n      if (mainContainer) {\n        mainContainer.innerHTML = \"\";\n\n        _this.resetBasicLayout(mainContainer);\n      }\n    };\n\n    if (this.html5Qrcode) {\n      return new Promise(function (resolve, reject) {\n        if (!_this.html5Qrcode) {\n          resolve();\n          return;\n        }\n\n        if (_this.html5Qrcode.isScanning) {\n          _this.html5Qrcode.stop().then(function (_) {\n            if (!_this.html5Qrcode) {\n              resolve();\n              return;\n            }\n\n            _this.html5Qrcode.clear();\n\n            emptyHtmlContainer();\n            resolve();\n          }).catch(function (error) {\n            if (_this.verbose) {\n              _this.logger.logError(\"Unable to stop qrcode scanner\", error);\n            }\n\n            reject(error);\n          });\n        } else {\n          _this.html5Qrcode.clear();\n\n          emptyHtmlContainer();\n          resolve();\n        }\n      });\n    }\n\n    return Promise.resolve();\n  };\n\n  Html5QrcodeScanner.prototype.getRunningTrackCapabilities = function () {\n    return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities();\n  };\n\n  Html5QrcodeScanner.prototype.getRunningTrackSettings = function () {\n    return this.getHtml5QrcodeOrFail().getRunningTrackSettings();\n  };\n\n  Html5QrcodeScanner.prototype.applyVideoConstraints = function (videoConstaints) {\n    return this.getHtml5QrcodeOrFail().applyVideoConstraints(videoConstaints);\n  };\n\n  Html5QrcodeScanner.prototype.getHtml5QrcodeOrFail = function () {\n    if (!this.html5Qrcode) {\n      throw \"Code scanner not initialized.\";\n    }\n\n    return this.html5Qrcode;\n  };\n\n  Html5QrcodeScanner.prototype.createConfig = function (config) {\n    if (config) {\n      if (!config.fps) {\n        config.fps = Html5QrcodeConstants.SCAN_DEFAULT_FPS;\n      }\n\n      if (config.rememberLastUsedCamera !== !Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED) {\n        config.rememberLastUsedCamera = Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED;\n      }\n\n      if (!config.supportedScanTypes) {\n        config.supportedScanTypes = Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE;\n      }\n\n      return config;\n    }\n\n    return {\n      fps: Html5QrcodeConstants.SCAN_DEFAULT_FPS,\n      rememberLastUsedCamera: Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED,\n      supportedScanTypes: Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE\n    };\n  };\n\n  Html5QrcodeScanner.prototype.createBasicLayout = function (parent) {\n    parent.style.position = \"relative\";\n    parent.style.padding = \"0px\";\n    parent.style.border = \"1px solid silver\";\n    this.createHeader(parent);\n    var qrCodeScanRegion = document.createElement(\"div\");\n    var scanRegionId = this.getScanRegionId();\n    qrCodeScanRegion.id = scanRegionId;\n    qrCodeScanRegion.style.width = \"100%\";\n    qrCodeScanRegion.style.minHeight = \"100px\";\n    qrCodeScanRegion.style.textAlign = \"center\";\n    parent.appendChild(qrCodeScanRegion);\n\n    if (ScanTypeSelector.isCameraScanType(this.currentScanType)) {\n      this.insertCameraScanImageToScanRegion();\n    } else {\n      this.insertFileScanImageToScanRegion();\n    }\n\n    var qrCodeDashboard = document.createElement(\"div\");\n    var dashboardId = this.getDashboardId();\n    qrCodeDashboard.id = dashboardId;\n    qrCodeDashboard.style.width = \"100%\";\n    parent.appendChild(qrCodeDashboard);\n    this.setupInitialDashboard(qrCodeDashboard);\n  };\n\n  Html5QrcodeScanner.prototype.resetBasicLayout = function (mainContainer) {\n    mainContainer.style.border = \"none\";\n  };\n\n  Html5QrcodeScanner.prototype.setupInitialDashboard = function (dashboard) {\n    this.createSection(dashboard);\n    this.createSectionControlPanel();\n\n    if (this.scanTypeSelector.hasMoreThanOneScanType()) {\n      this.createSectionSwap();\n    }\n  };\n\n  Html5QrcodeScanner.prototype.createHeader = function (dashboard) {\n    var header = document.createElement(\"div\");\n    header.style.textAlign = \"left\";\n    header.style.margin = \"0px\";\n    dashboard.appendChild(header);\n    var libraryInfo = new LibraryInfoContainer();\n    libraryInfo.renderInto(header);\n    var headerMessageContainer = document.createElement(\"div\");\n    headerMessageContainer.id = this.getHeaderMessageContainerId();\n    headerMessageContainer.style.display = \"none\";\n    headerMessageContainer.style.textAlign = \"center\";\n    headerMessageContainer.style.fontSize = \"14px\";\n    headerMessageContainer.style.padding = \"2px 10px\";\n    headerMessageContainer.style.margin = \"4px\";\n    headerMessageContainer.style.borderTop = \"1px solid #f6f6f6\";\n    header.appendChild(headerMessageContainer);\n  };\n\n  Html5QrcodeScanner.prototype.createSection = function (dashboard) {\n    var section = document.createElement(\"div\");\n    section.id = this.getDashboardSectionId();\n    section.style.width = \"100%\";\n    section.style.padding = \"10px 0px 10px 0px\";\n    section.style.textAlign = \"left\";\n    dashboard.appendChild(section);\n  };\n\n  Html5QrcodeScanner.prototype.createCameraListUi = function (scpCameraScanRegion, requestPermissionContainer, requestPermissionButton) {\n    var $this = this;\n    $this.showHideScanTypeSwapLink(false);\n    $this.setHeaderMessage(Html5QrcodeScannerStrings.cameraPermissionRequesting());\n\n    var createPermissionButtonIfNotExists = function () {\n      if (!requestPermissionButton) {\n        $this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n      }\n    };\n\n    Html5Qrcode.getCameras().then(function (cameras) {\n      $this.persistedDataManager.setHasPermission(true);\n      $this.showHideScanTypeSwapLink(true);\n      $this.resetHeaderMessage();\n\n      if (cameras && cameras.length > 0) {\n        scpCameraScanRegion.removeChild(requestPermissionContainer);\n        $this.renderCameraSelection(cameras);\n      } else {\n        $this.setHeaderMessage(Html5QrcodeScannerStrings.noCameraFound(), Html5QrcodeScannerStatus.STATUS_WARNING);\n        createPermissionButtonIfNotExists();\n      }\n    }).catch(function (error) {\n      $this.persistedDataManager.setHasPermission(false);\n\n      if (requestPermissionButton) {\n        requestPermissionButton.disabled = false;\n      } else {\n        createPermissionButtonIfNotExists();\n      }\n\n      $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n      $this.showHideScanTypeSwapLink(true);\n    });\n  };\n\n  Html5QrcodeScanner.prototype.createPermissionButton = function (scpCameraScanRegion, requestPermissionContainer) {\n    var $this = this;\n    var requestPermissionButton = BaseUiElementFactory.createElement(\"button\", this.getCameraPermissionButtonId());\n    requestPermissionButton.innerText = Html5QrcodeScannerStrings.cameraPermissionTitle();\n    requestPermissionButton.addEventListener(\"click\", function () {\n      requestPermissionButton.disabled = true;\n      $this.createCameraListUi(scpCameraScanRegion, requestPermissionContainer, requestPermissionButton);\n    });\n    requestPermissionContainer.appendChild(requestPermissionButton);\n  };\n\n  Html5QrcodeScanner.prototype.createPermissionsUi = function (scpCameraScanRegion, requestPermissionContainer) {\n    var $this = this;\n\n    if (ScanTypeSelector.isCameraScanType(this.currentScanType) && this.persistedDataManager.hasCameraPermissions()) {\n      CameraPermissions.hasPermissions().then(function (hasPermissions) {\n        if (hasPermissions) {\n          $this.createCameraListUi(scpCameraScanRegion, requestPermissionContainer);\n        } else {\n          $this.persistedDataManager.setHasPermission(false);\n          $this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n        }\n      }).catch(function (_) {\n        $this.persistedDataManager.setHasPermission(false);\n        $this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n      });\n      return;\n    }\n\n    this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n  };\n\n  Html5QrcodeScanner.prototype.createSectionControlPanel = function () {\n    var section = document.getElementById(this.getDashboardSectionId());\n    var sectionControlPanel = document.createElement(\"div\");\n    section.appendChild(sectionControlPanel);\n    var scpCameraScanRegion = document.createElement(\"div\");\n    scpCameraScanRegion.id = this.getDashboardSectionCameraScanRegionId();\n    scpCameraScanRegion.style.display = ScanTypeSelector.isCameraScanType(this.currentScanType) ? \"block\" : \"none\";\n    sectionControlPanel.appendChild(scpCameraScanRegion);\n    var requestPermissionContainer = document.createElement(\"div\");\n    requestPermissionContainer.style.textAlign = \"center\";\n    scpCameraScanRegion.appendChild(requestPermissionContainer);\n\n    if (this.scanTypeSelector.isCameraScanRequired()) {\n      this.createPermissionsUi(scpCameraScanRegion, requestPermissionContainer);\n    }\n\n    this.renderFileScanUi(sectionControlPanel);\n  };\n\n  Html5QrcodeScanner.prototype.renderFileScanUi = function (parent) {\n    var showOnRender = ScanTypeSelector.isFileScanType(this.currentScanType);\n    var $this = this;\n\n    var onFileSelected = function (file) {\n      if (!$this.html5Qrcode) {\n        throw \"html5Qrcode not defined\";\n      }\n\n      if (!ScanTypeSelector.isFileScanType($this.currentScanType)) {\n        return;\n      }\n\n      $this.setHeaderMessage(Html5QrcodeScannerStrings.loadingImage());\n      $this.html5Qrcode.scanFileV2(file, true).then(function (html5qrcodeResult) {\n        $this.resetHeaderMessage();\n        $this.qrCodeSuccessCallback(html5qrcodeResult.decodedText, html5qrcodeResult);\n      }).catch(function (error) {\n        $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n        $this.qrCodeErrorCallback(error, Html5QrcodeErrorFactory.createFrom(error));\n      });\n    };\n\n    this.fileSelectionUi = FileSelectionUi.create(parent, showOnRender, onFileSelected);\n  };\n\n  Html5QrcodeScanner.prototype.renderCameraSelection = function (cameras) {\n    var _this = this;\n\n    var $this = this;\n    var scpCameraScanRegion = document.getElementById(this.getDashboardSectionCameraScanRegionId());\n    scpCameraScanRegion.style.textAlign = \"center\";\n    var cameraZoomUi = CameraZoomUi.create(scpCameraScanRegion, false);\n\n    var renderCameraZoomUiIfSupported = function (cameraCapabilities) {\n      var zoomCapability = cameraCapabilities.zoomFeature();\n\n      if (!zoomCapability.isSupported()) {\n        return;\n      }\n\n      cameraZoomUi.setOnCameraZoomValueChangeCallback(function (zoomValue) {\n        zoomCapability.apply(zoomValue);\n      });\n      var defaultZoom = 1;\n\n      if (_this.config.defaultZoomValueIfSupported) {\n        defaultZoom = _this.config.defaultZoomValueIfSupported;\n      }\n\n      defaultZoom = clip(defaultZoom, zoomCapability.min(), zoomCapability.max());\n      cameraZoomUi.setValues(zoomCapability.min(), zoomCapability.max(), defaultZoom, zoomCapability.step());\n      cameraZoomUi.show();\n    };\n\n    var cameraSelectUi = CameraSelectionUi.create(scpCameraScanRegion, cameras);\n    var cameraActionContainer = document.createElement(\"span\");\n    var cameraActionStartButton = BaseUiElementFactory.createElement(\"button\", PublicUiElementIdAndClasses.CAMERA_START_BUTTON_ID);\n    cameraActionStartButton.innerText = Html5QrcodeScannerStrings.scanButtonStartScanningText();\n    cameraActionContainer.appendChild(cameraActionStartButton);\n    var cameraActionStopButton = BaseUiElementFactory.createElement(\"button\", PublicUiElementIdAndClasses.CAMERA_STOP_BUTTON_ID);\n    cameraActionStopButton.innerText = Html5QrcodeScannerStrings.scanButtonStopScanningText();\n    cameraActionStopButton.style.display = \"none\";\n    cameraActionStopButton.disabled = true;\n    cameraActionContainer.appendChild(cameraActionStopButton);\n    var torchButton;\n\n    var createAndShowTorchButtonIfSupported = function (cameraCapabilities) {\n      if (!cameraCapabilities.torchFeature().isSupported()) {\n        if (torchButton) {\n          torchButton.hide();\n        }\n\n        return;\n      }\n\n      if (!torchButton) {\n        torchButton = TorchButton.create(cameraActionContainer, cameraCapabilities.torchFeature(), {\n          display: \"none\",\n          marginLeft: \"5px\"\n        }, function (errorMessage) {\n          $this.setHeaderMessage(errorMessage, Html5QrcodeScannerStatus.STATUS_WARNING);\n        });\n      } else {\n        torchButton.updateTorchCapability(cameraCapabilities.torchFeature());\n      }\n\n      torchButton.show();\n    };\n\n    scpCameraScanRegion.appendChild(cameraActionContainer);\n\n    var resetCameraActionStartButton = function (shouldShow) {\n      if (!shouldShow) {\n        cameraActionStartButton.style.display = \"none\";\n      }\n\n      cameraActionStartButton.innerText = Html5QrcodeScannerStrings.scanButtonStartScanningText();\n      cameraActionStartButton.style.opacity = \"1\";\n      cameraActionStartButton.disabled = false;\n\n      if (shouldShow) {\n        cameraActionStartButton.style.display = \"inline-block\";\n      }\n    };\n\n    cameraActionStartButton.addEventListener(\"click\", function (_) {\n      cameraActionStartButton.innerText = Html5QrcodeScannerStrings.scanButtonScanningStarting();\n      cameraSelectUi.disable();\n      cameraActionStartButton.disabled = true;\n      cameraActionStartButton.style.opacity = \"0.5\";\n\n      if (_this.scanTypeSelector.hasMoreThanOneScanType()) {\n        $this.showHideScanTypeSwapLink(false);\n      }\n\n      $this.resetHeaderMessage();\n      var cameraId = cameraSelectUi.getValue();\n      $this.persistedDataManager.setLastUsedCameraId(cameraId);\n      $this.html5Qrcode.start(cameraId, toHtml5QrcodeCameraScanConfig($this.config), $this.qrCodeSuccessCallback, $this.qrCodeErrorCallback).then(function (_) {\n        cameraActionStopButton.disabled = false;\n        cameraActionStopButton.style.display = \"inline-block\";\n        resetCameraActionStartButton(false);\n        var cameraCapabilities = $this.html5Qrcode.getRunningTrackCameraCapabilities();\n\n        if (_this.config.showTorchButtonIfSupported === true) {\n          createAndShowTorchButtonIfSupported(cameraCapabilities);\n        }\n\n        if (_this.config.showZoomSliderIfSupported === true) {\n          renderCameraZoomUiIfSupported(cameraCapabilities);\n        }\n      }).catch(function (error) {\n        $this.showHideScanTypeSwapLink(true);\n        cameraSelectUi.enable();\n        resetCameraActionStartButton(true);\n        $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n      });\n    });\n\n    if (cameraSelectUi.hasSingleItem()) {\n      cameraActionStartButton.click();\n    }\n\n    cameraActionStopButton.addEventListener(\"click\", function (_) {\n      if (!$this.html5Qrcode) {\n        throw \"html5Qrcode not defined\";\n      }\n\n      cameraActionStopButton.disabled = true;\n      $this.html5Qrcode.stop().then(function (_) {\n        if (_this.scanTypeSelector.hasMoreThanOneScanType()) {\n          $this.showHideScanTypeSwapLink(true);\n        }\n\n        cameraSelectUi.enable();\n        cameraActionStartButton.disabled = false;\n        cameraActionStopButton.style.display = \"none\";\n        cameraActionStartButton.style.display = \"inline-block\";\n\n        if (torchButton) {\n          torchButton.reset();\n          torchButton.hide();\n        }\n\n        cameraZoomUi.removeOnCameraZoomValueChangeCallback();\n        cameraZoomUi.hide();\n        $this.insertCameraScanImageToScanRegion();\n      }).catch(function (error) {\n        cameraActionStopButton.disabled = false;\n        $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n      });\n    });\n\n    if ($this.persistedDataManager.getLastUsedCameraId()) {\n      var cameraId = $this.persistedDataManager.getLastUsedCameraId();\n\n      if (cameraSelectUi.hasValue(cameraId)) {\n        cameraSelectUi.setValue(cameraId);\n        cameraActionStartButton.click();\n      } else {\n        $this.persistedDataManager.resetLastUsedCameraId();\n      }\n    }\n  };\n\n  Html5QrcodeScanner.prototype.createSectionSwap = function () {\n    var $this = this;\n    var TEXT_IF_CAMERA_SCAN_SELECTED = Html5QrcodeScannerStrings.textIfCameraScanSelected();\n    var TEXT_IF_FILE_SCAN_SELECTED = Html5QrcodeScannerStrings.textIfFileScanSelected();\n    var section = document.getElementById(this.getDashboardSectionId());\n    var switchContainer = document.createElement(\"div\");\n    switchContainer.style.textAlign = \"center\";\n    var switchScanTypeLink = BaseUiElementFactory.createElement(\"span\", this.getDashboardSectionSwapLinkId());\n    switchScanTypeLink.style.textDecoration = \"underline\";\n    switchScanTypeLink.style.cursor = \"pointer\";\n    switchScanTypeLink.innerText = ScanTypeSelector.isCameraScanType(this.currentScanType) ? TEXT_IF_CAMERA_SCAN_SELECTED : TEXT_IF_FILE_SCAN_SELECTED;\n    switchScanTypeLink.addEventListener(\"click\", function () {\n      if (!$this.sectionSwapAllowed) {\n        if ($this.verbose) {\n          $this.logger.logError(\"Section swap called when not allowed\");\n        }\n\n        return;\n      }\n\n      $this.resetHeaderMessage();\n      $this.fileSelectionUi.resetValue();\n      $this.sectionSwapAllowed = false;\n\n      if (ScanTypeSelector.isCameraScanType($this.currentScanType)) {\n        $this.clearScanRegion();\n        $this.getCameraScanRegion().style.display = \"none\";\n        $this.fileSelectionUi.show();\n        switchScanTypeLink.innerText = TEXT_IF_FILE_SCAN_SELECTED;\n        $this.currentScanType = Html5QrcodeScanType.SCAN_TYPE_FILE;\n        $this.insertFileScanImageToScanRegion();\n      } else {\n        $this.clearScanRegion();\n        $this.getCameraScanRegion().style.display = \"block\";\n        $this.fileSelectionUi.hide();\n        switchScanTypeLink.innerText = TEXT_IF_CAMERA_SCAN_SELECTED;\n        $this.currentScanType = Html5QrcodeScanType.SCAN_TYPE_CAMERA;\n        $this.insertCameraScanImageToScanRegion();\n        $this.startCameraScanIfPermissionExistsOnSwap();\n      }\n\n      $this.sectionSwapAllowed = true;\n    });\n    switchContainer.appendChild(switchScanTypeLink);\n    section.appendChild(switchContainer);\n  };\n\n  Html5QrcodeScanner.prototype.startCameraScanIfPermissionExistsOnSwap = function () {\n    var _this = this;\n\n    var $this = this;\n\n    if (this.persistedDataManager.hasCameraPermissions()) {\n      CameraPermissions.hasPermissions().then(function (hasPermissions) {\n        if (hasPermissions) {\n          var permissionButton = document.getElementById($this.getCameraPermissionButtonId());\n\n          if (!permissionButton) {\n            _this.logger.logError(\"Permission button not found, fail;\");\n\n            throw \"Permission button not found\";\n          }\n\n          permissionButton.click();\n        } else {\n          $this.persistedDataManager.setHasPermission(false);\n        }\n      }).catch(function (_) {\n        $this.persistedDataManager.setHasPermission(false);\n      });\n      return;\n    }\n  };\n\n  Html5QrcodeScanner.prototype.resetHeaderMessage = function () {\n    var messageDiv = document.getElementById(this.getHeaderMessageContainerId());\n    messageDiv.style.display = \"none\";\n  };\n\n  Html5QrcodeScanner.prototype.setHeaderMessage = function (messageText, scannerStatus) {\n    if (!scannerStatus) {\n      scannerStatus = Html5QrcodeScannerStatus.STATUS_DEFAULT;\n    }\n\n    var messageDiv = this.getHeaderMessageDiv();\n    messageDiv.innerText = messageText;\n    messageDiv.style.display = \"block\";\n\n    switch (scannerStatus) {\n      case Html5QrcodeScannerStatus.STATUS_SUCCESS:\n        messageDiv.style.background = \"rgba(106, 175, 80, 0.26)\";\n        messageDiv.style.color = \"#477735\";\n        break;\n\n      case Html5QrcodeScannerStatus.STATUS_WARNING:\n        messageDiv.style.background = \"rgba(203, 36, 49, 0.14)\";\n        messageDiv.style.color = \"#cb2431\";\n        break;\n\n      case Html5QrcodeScannerStatus.STATUS_DEFAULT:\n      default:\n        messageDiv.style.background = \"rgba(0, 0, 0, 0)\";\n        messageDiv.style.color = \"rgb(17, 17, 17)\";\n        break;\n    }\n  };\n\n  Html5QrcodeScanner.prototype.showHideScanTypeSwapLink = function (shouldDisplay) {\n    if (this.scanTypeSelector.hasMoreThanOneScanType()) {\n      if (shouldDisplay !== true) {\n        shouldDisplay = false;\n      }\n\n      this.sectionSwapAllowed = shouldDisplay;\n      this.getDashboardSectionSwapLink().style.display = shouldDisplay ? \"inline-block\" : \"none\";\n    }\n  };\n\n  Html5QrcodeScanner.prototype.insertCameraScanImageToScanRegion = function () {\n    var $this = this;\n    var qrCodeScanRegion = document.getElementById(this.getScanRegionId());\n\n    if (this.cameraScanImage) {\n      qrCodeScanRegion.innerHTML = \"<br>\";\n      qrCodeScanRegion.appendChild(this.cameraScanImage);\n      return;\n    }\n\n    this.cameraScanImage = new Image();\n\n    this.cameraScanImage.onload = function (_) {\n      qrCodeScanRegion.innerHTML = \"<br>\";\n      qrCodeScanRegion.appendChild($this.cameraScanImage);\n    };\n\n    this.cameraScanImage.width = 64;\n    this.cameraScanImage.style.opacity = \"0.8\";\n    this.cameraScanImage.src = ASSET_CAMERA_SCAN;\n    this.cameraScanImage.alt = Html5QrcodeScannerStrings.cameraScanAltText();\n  };\n\n  Html5QrcodeScanner.prototype.insertFileScanImageToScanRegion = function () {\n    var $this = this;\n    var qrCodeScanRegion = document.getElementById(this.getScanRegionId());\n\n    if (this.fileScanImage) {\n      qrCodeScanRegion.innerHTML = \"<br>\";\n      qrCodeScanRegion.appendChild(this.fileScanImage);\n      return;\n    }\n\n    this.fileScanImage = new Image();\n\n    this.fileScanImage.onload = function (_) {\n      qrCodeScanRegion.innerHTML = \"<br>\";\n      qrCodeScanRegion.appendChild($this.fileScanImage);\n    };\n\n    this.fileScanImage.width = 64;\n    this.fileScanImage.style.opacity = \"0.8\";\n    this.fileScanImage.src = ASSET_FILE_SCAN;\n    this.fileScanImage.alt = Html5QrcodeScannerStrings.fileScanAltText();\n  };\n\n  Html5QrcodeScanner.prototype.clearScanRegion = function () {\n    var qrCodeScanRegion = document.getElementById(this.getScanRegionId());\n    qrCodeScanRegion.innerHTML = \"\";\n  };\n\n  Html5QrcodeScanner.prototype.getDashboardSectionId = function () {\n    return \"\".concat(this.elementId, \"__dashboard_section\");\n  };\n\n  Html5QrcodeScanner.prototype.getDashboardSectionCameraScanRegionId = function () {\n    return \"\".concat(this.elementId, \"__dashboard_section_csr\");\n  };\n\n  Html5QrcodeScanner.prototype.getDashboardSectionSwapLinkId = function () {\n    return PublicUiElementIdAndClasses.SCAN_TYPE_CHANGE_ANCHOR_ID;\n  };\n\n  Html5QrcodeScanner.prototype.getScanRegionId = function () {\n    return \"\".concat(this.elementId, \"__scan_region\");\n  };\n\n  Html5QrcodeScanner.prototype.getDashboardId = function () {\n    return \"\".concat(this.elementId, \"__dashboard\");\n  };\n\n  Html5QrcodeScanner.prototype.getHeaderMessageContainerId = function () {\n    return \"\".concat(this.elementId, \"__header_message\");\n  };\n\n  Html5QrcodeScanner.prototype.getCameraPermissionButtonId = function () {\n    return PublicUiElementIdAndClasses.CAMERA_PERMISSION_BUTTON_ID;\n  };\n\n  Html5QrcodeScanner.prototype.getCameraScanRegion = function () {\n    return document.getElementById(this.getDashboardSectionCameraScanRegionId());\n  };\n\n  Html5QrcodeScanner.prototype.getDashboardSectionSwapLink = function () {\n    return document.getElementById(this.getDashboardSectionSwapLinkId());\n  };\n\n  Html5QrcodeScanner.prototype.getHeaderMessageDiv = function () {\n    return document.getElementById(this.getHeaderMessageContainerId());\n  };\n\n  return Html5QrcodeScanner;\n}();\n\nexport { Html5QrcodeScanner };","map":{"version":3,"sources":["../../src/html5-qrcode-scanner.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { Html5QrcodeConstants, Html5QrcodeScanType, Html5QrcodeErrorFactory, BaseLoggger, isNullOrUndefined, clip, } from \"./core\";\nimport { Html5Qrcode, } from \"./html5-qrcode\";\nimport { Html5QrcodeScannerStrings, } from \"./strings\";\nimport { ASSET_FILE_SCAN, ASSET_CAMERA_SCAN, } from \"./image-assets\";\nimport { PersistedDataManager } from \"./storage\";\nimport { LibraryInfoContainer } from \"./ui\";\nimport { CameraPermissions } from \"./camera/permissions\";\nimport { ScanTypeSelector } from \"./ui/scanner/scan-type-selector\";\nimport { TorchButton } from \"./ui/scanner/torch-button\";\nimport { FileSelectionUi } from \"./ui/scanner/file-selection-ui\";\nimport { BaseUiElementFactory, PublicUiElementIdAndClasses } from \"./ui/scanner/base\";\nimport { CameraSelectionUi } from \"./ui/scanner/camera-selection-ui\";\nimport { CameraZoomUi } from \"./ui/scanner/camera-zoom-ui\";\nvar Html5QrcodeScannerStatus;\n(function (Html5QrcodeScannerStatus) {\n    Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_DEFAULT\"] = 0] = \"STATUS_DEFAULT\";\n    Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_SUCCESS\"] = 1] = \"STATUS_SUCCESS\";\n    Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_WARNING\"] = 2] = \"STATUS_WARNING\";\n    Html5QrcodeScannerStatus[Html5QrcodeScannerStatus[\"STATUS_REQUESTING_PERMISSION\"] = 3] = \"STATUS_REQUESTING_PERMISSION\";\n})(Html5QrcodeScannerStatus || (Html5QrcodeScannerStatus = {}));\nfunction toHtml5QrcodeCameraScanConfig(config) {\n    return {\n        fps: config.fps,\n        qrbox: config.qrbox,\n        aspectRatio: config.aspectRatio,\n        disableFlip: config.disableFlip,\n        videoConstraints: config.videoConstraints\n    };\n}\nfunction toHtml5QrcodeFullConfig(config, verbose) {\n    return {\n        formatsToSupport: config.formatsToSupport,\n        useBarCodeDetectorIfSupported: config.useBarCodeDetectorIfSupported,\n        experimentalFeatures: config.experimentalFeatures,\n        verbose: verbose\n    };\n}\nvar Html5QrcodeScanner = (function () {\n    function Html5QrcodeScanner(elementId, config, verbose) {\n        this.lastMatchFound = null;\n        this.cameraScanImage = null;\n        this.fileScanImage = null;\n        this.fileSelectionUi = null;\n        this.elementId = elementId;\n        this.config = this.createConfig(config);\n        this.verbose = verbose === true;\n        if (!document.getElementById(elementId)) {\n            throw \"HTML Element with id=\".concat(elementId, \" not found\");\n        }\n        this.scanTypeSelector = new ScanTypeSelector(this.config.supportedScanTypes);\n        this.currentScanType = this.scanTypeSelector.getDefaultScanType();\n        this.sectionSwapAllowed = true;\n        this.logger = new BaseLoggger(this.verbose);\n        this.persistedDataManager = new PersistedDataManager();\n        if (config.rememberLastUsedCamera !== true) {\n            this.persistedDataManager.reset();\n        }\n    }\n    Html5QrcodeScanner.prototype.render = function (qrCodeSuccessCallback, qrCodeErrorCallback) {\n        var _this = this;\n        this.lastMatchFound = null;\n        this.qrCodeSuccessCallback\n            = function (decodedText, result) {\n                if (qrCodeSuccessCallback) {\n                    qrCodeSuccessCallback(decodedText, result);\n                }\n                else {\n                    if (_this.lastMatchFound === decodedText) {\n                        return;\n                    }\n                    _this.lastMatchFound = decodedText;\n                    _this.setHeaderMessage(Html5QrcodeScannerStrings.lastMatch(decodedText), Html5QrcodeScannerStatus.STATUS_SUCCESS);\n                }\n            };\n        this.qrCodeErrorCallback =\n            function (errorMessage, error) {\n                if (qrCodeErrorCallback) {\n                    qrCodeErrorCallback(errorMessage, error);\n                }\n            };\n        var container = document.getElementById(this.elementId);\n        if (!container) {\n            throw \"HTML Element with id=\".concat(this.elementId, \" not found\");\n        }\n        container.innerHTML = \"\";\n        this.createBasicLayout(container);\n        this.html5Qrcode = new Html5Qrcode(this.getScanRegionId(), toHtml5QrcodeFullConfig(this.config, this.verbose));\n    };\n    Html5QrcodeScanner.prototype.pause = function (shouldPauseVideo) {\n        if (isNullOrUndefined(shouldPauseVideo) || shouldPauseVideo !== true) {\n            shouldPauseVideo = false;\n        }\n        this.getHtml5QrcodeOrFail().pause(shouldPauseVideo);\n    };\n    Html5QrcodeScanner.prototype.resume = function () {\n        this.getHtml5QrcodeOrFail().resume();\n    };\n    Html5QrcodeScanner.prototype.getState = function () {\n        return this.getHtml5QrcodeOrFail().getState();\n    };\n    Html5QrcodeScanner.prototype.clear = function () {\n        var _this = this;\n        var emptyHtmlContainer = function () {\n            var mainContainer = document.getElementById(_this.elementId);\n            if (mainContainer) {\n                mainContainer.innerHTML = \"\";\n                _this.resetBasicLayout(mainContainer);\n            }\n        };\n        if (this.html5Qrcode) {\n            return new Promise(function (resolve, reject) {\n                if (!_this.html5Qrcode) {\n                    resolve();\n                    return;\n                }\n                if (_this.html5Qrcode.isScanning) {\n                    _this.html5Qrcode.stop().then(function (_) {\n                        if (!_this.html5Qrcode) {\n                            resolve();\n                            return;\n                        }\n                        _this.html5Qrcode.clear();\n                        emptyHtmlContainer();\n                        resolve();\n                    }).catch(function (error) {\n                        if (_this.verbose) {\n                            _this.logger.logError(\"Unable to stop qrcode scanner\", error);\n                        }\n                        reject(error);\n                    });\n                }\n                else {\n                    _this.html5Qrcode.clear();\n                    emptyHtmlContainer();\n                    resolve();\n                }\n            });\n        }\n        return Promise.resolve();\n    };\n    Html5QrcodeScanner.prototype.getRunningTrackCapabilities = function () {\n        return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities();\n    };\n    Html5QrcodeScanner.prototype.getRunningTrackSettings = function () {\n        return this.getHtml5QrcodeOrFail().getRunningTrackSettings();\n    };\n    Html5QrcodeScanner.prototype.applyVideoConstraints = function (videoConstaints) {\n        return this.getHtml5QrcodeOrFail().applyVideoConstraints(videoConstaints);\n    };\n    Html5QrcodeScanner.prototype.getHtml5QrcodeOrFail = function () {\n        if (!this.html5Qrcode) {\n            throw \"Code scanner not initialized.\";\n        }\n        return this.html5Qrcode;\n    };\n    Html5QrcodeScanner.prototype.createConfig = function (config) {\n        if (config) {\n            if (!config.fps) {\n                config.fps = Html5QrcodeConstants.SCAN_DEFAULT_FPS;\n            }\n            if (config.rememberLastUsedCamera !== (!Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED)) {\n                config.rememberLastUsedCamera\n                    = Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED;\n            }\n            if (!config.supportedScanTypes) {\n                config.supportedScanTypes\n                    = Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE;\n            }\n            return config;\n        }\n        return {\n            fps: Html5QrcodeConstants.SCAN_DEFAULT_FPS,\n            rememberLastUsedCamera: Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED,\n            supportedScanTypes: Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE\n        };\n    };\n    Html5QrcodeScanner.prototype.createBasicLayout = function (parent) {\n        parent.style.position = \"relative\";\n        parent.style.padding = \"0px\";\n        parent.style.border = \"1px solid silver\";\n        this.createHeader(parent);\n        var qrCodeScanRegion = document.createElement(\"div\");\n        var scanRegionId = this.getScanRegionId();\n        qrCodeScanRegion.id = scanRegionId;\n        qrCodeScanRegion.style.width = \"100%\";\n        qrCodeScanRegion.style.minHeight = \"100px\";\n        qrCodeScanRegion.style.textAlign = \"center\";\n        parent.appendChild(qrCodeScanRegion);\n        if (ScanTypeSelector.isCameraScanType(this.currentScanType)) {\n            this.insertCameraScanImageToScanRegion();\n        }\n        else {\n            this.insertFileScanImageToScanRegion();\n        }\n        var qrCodeDashboard = document.createElement(\"div\");\n        var dashboardId = this.getDashboardId();\n        qrCodeDashboard.id = dashboardId;\n        qrCodeDashboard.style.width = \"100%\";\n        parent.appendChild(qrCodeDashboard);\n        this.setupInitialDashboard(qrCodeDashboard);\n    };\n    Html5QrcodeScanner.prototype.resetBasicLayout = function (mainContainer) {\n        mainContainer.style.border = \"none\";\n    };\n    Html5QrcodeScanner.prototype.setupInitialDashboard = function (dashboard) {\n        this.createSection(dashboard);\n        this.createSectionControlPanel();\n        if (this.scanTypeSelector.hasMoreThanOneScanType()) {\n            this.createSectionSwap();\n        }\n    };\n    Html5QrcodeScanner.prototype.createHeader = function (dashboard) {\n        var header = document.createElement(\"div\");\n        header.style.textAlign = \"left\";\n        header.style.margin = \"0px\";\n        dashboard.appendChild(header);\n        var libraryInfo = new LibraryInfoContainer();\n        libraryInfo.renderInto(header);\n        var headerMessageContainer = document.createElement(\"div\");\n        headerMessageContainer.id = this.getHeaderMessageContainerId();\n        headerMessageContainer.style.display = \"none\";\n        headerMessageContainer.style.textAlign = \"center\";\n        headerMessageContainer.style.fontSize = \"14px\";\n        headerMessageContainer.style.padding = \"2px 10px\";\n        headerMessageContainer.style.margin = \"4px\";\n        headerMessageContainer.style.borderTop = \"1px solid #f6f6f6\";\n        header.appendChild(headerMessageContainer);\n    };\n    Html5QrcodeScanner.prototype.createSection = function (dashboard) {\n        var section = document.createElement(\"div\");\n        section.id = this.getDashboardSectionId();\n        section.style.width = \"100%\";\n        section.style.padding = \"10px 0px 10px 0px\";\n        section.style.textAlign = \"left\";\n        dashboard.appendChild(section);\n    };\n    Html5QrcodeScanner.prototype.createCameraListUi = function (scpCameraScanRegion, requestPermissionContainer, requestPermissionButton) {\n        var $this = this;\n        $this.showHideScanTypeSwapLink(false);\n        $this.setHeaderMessage(Html5QrcodeScannerStrings.cameraPermissionRequesting());\n        var createPermissionButtonIfNotExists = function () {\n            if (!requestPermissionButton) {\n                $this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n            }\n        };\n        Html5Qrcode.getCameras().then(function (cameras) {\n            $this.persistedDataManager.setHasPermission(true);\n            $this.showHideScanTypeSwapLink(true);\n            $this.resetHeaderMessage();\n            if (cameras && cameras.length > 0) {\n                scpCameraScanRegion.removeChild(requestPermissionContainer);\n                $this.renderCameraSelection(cameras);\n            }\n            else {\n                $this.setHeaderMessage(Html5QrcodeScannerStrings.noCameraFound(), Html5QrcodeScannerStatus.STATUS_WARNING);\n                createPermissionButtonIfNotExists();\n            }\n        }).catch(function (error) {\n            $this.persistedDataManager.setHasPermission(false);\n            if (requestPermissionButton) {\n                requestPermissionButton.disabled = false;\n            }\n            else {\n                createPermissionButtonIfNotExists();\n            }\n            $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n            $this.showHideScanTypeSwapLink(true);\n        });\n    };\n    Html5QrcodeScanner.prototype.createPermissionButton = function (scpCameraScanRegion, requestPermissionContainer) {\n        var $this = this;\n        var requestPermissionButton = BaseUiElementFactory\n            .createElement(\"button\", this.getCameraPermissionButtonId());\n        requestPermissionButton.innerText\n            = Html5QrcodeScannerStrings.cameraPermissionTitle();\n        requestPermissionButton.addEventListener(\"click\", function () {\n            requestPermissionButton.disabled = true;\n            $this.createCameraListUi(scpCameraScanRegion, requestPermissionContainer, requestPermissionButton);\n        });\n        requestPermissionContainer.appendChild(requestPermissionButton);\n    };\n    Html5QrcodeScanner.prototype.createPermissionsUi = function (scpCameraScanRegion, requestPermissionContainer) {\n        var $this = this;\n        if (ScanTypeSelector.isCameraScanType(this.currentScanType)\n            && this.persistedDataManager.hasCameraPermissions()) {\n            CameraPermissions.hasPermissions().then(function (hasPermissions) {\n                if (hasPermissions) {\n                    $this.createCameraListUi(scpCameraScanRegion, requestPermissionContainer);\n                }\n                else {\n                    $this.persistedDataManager.setHasPermission(false);\n                    $this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n                }\n            }).catch(function (_) {\n                $this.persistedDataManager.setHasPermission(false);\n                $this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n            });\n            return;\n        }\n        this.createPermissionButton(scpCameraScanRegion, requestPermissionContainer);\n    };\n    Html5QrcodeScanner.prototype.createSectionControlPanel = function () {\n        var section = document.getElementById(this.getDashboardSectionId());\n        var sectionControlPanel = document.createElement(\"div\");\n        section.appendChild(sectionControlPanel);\n        var scpCameraScanRegion = document.createElement(\"div\");\n        scpCameraScanRegion.id = this.getDashboardSectionCameraScanRegionId();\n        scpCameraScanRegion.style.display\n            = ScanTypeSelector.isCameraScanType(this.currentScanType)\n                ? \"block\" : \"none\";\n        sectionControlPanel.appendChild(scpCameraScanRegion);\n        var requestPermissionContainer = document.createElement(\"div\");\n        requestPermissionContainer.style.textAlign = \"center\";\n        scpCameraScanRegion.appendChild(requestPermissionContainer);\n        if (this.scanTypeSelector.isCameraScanRequired()) {\n            this.createPermissionsUi(scpCameraScanRegion, requestPermissionContainer);\n        }\n        this.renderFileScanUi(sectionControlPanel);\n    };\n    Html5QrcodeScanner.prototype.renderFileScanUi = function (parent) {\n        var showOnRender = ScanTypeSelector.isFileScanType(this.currentScanType);\n        var $this = this;\n        var onFileSelected = function (file) {\n            if (!$this.html5Qrcode) {\n                throw \"html5Qrcode not defined\";\n            }\n            if (!ScanTypeSelector.isFileScanType($this.currentScanType)) {\n                return;\n            }\n            $this.setHeaderMessage(Html5QrcodeScannerStrings.loadingImage());\n            $this.html5Qrcode.scanFileV2(file, true)\n                .then(function (html5qrcodeResult) {\n                $this.resetHeaderMessage();\n                $this.qrCodeSuccessCallback(html5qrcodeResult.decodedText, html5qrcodeResult);\n            })\n                .catch(function (error) {\n                $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n                $this.qrCodeErrorCallback(error, Html5QrcodeErrorFactory.createFrom(error));\n            });\n        };\n        this.fileSelectionUi = FileSelectionUi.create(parent, showOnRender, onFileSelected);\n    };\n    Html5QrcodeScanner.prototype.renderCameraSelection = function (cameras) {\n        var _this = this;\n        var $this = this;\n        var scpCameraScanRegion = document.getElementById(this.getDashboardSectionCameraScanRegionId());\n        scpCameraScanRegion.style.textAlign = \"center\";\n        var cameraZoomUi = CameraZoomUi.create(scpCameraScanRegion, false);\n        var renderCameraZoomUiIfSupported = function (cameraCapabilities) {\n            var zoomCapability = cameraCapabilities.zoomFeature();\n            if (!zoomCapability.isSupported()) {\n                return;\n            }\n            cameraZoomUi.setOnCameraZoomValueChangeCallback(function (zoomValue) {\n                zoomCapability.apply(zoomValue);\n            });\n            var defaultZoom = 1;\n            if (_this.config.defaultZoomValueIfSupported) {\n                defaultZoom = _this.config.defaultZoomValueIfSupported;\n            }\n            defaultZoom = clip(defaultZoom, zoomCapability.min(), zoomCapability.max());\n            cameraZoomUi.setValues(zoomCapability.min(), zoomCapability.max(), defaultZoom, zoomCapability.step());\n            cameraZoomUi.show();\n        };\n        var cameraSelectUi = CameraSelectionUi.create(scpCameraScanRegion, cameras);\n        var cameraActionContainer = document.createElement(\"span\");\n        var cameraActionStartButton = BaseUiElementFactory.createElement(\"button\", PublicUiElementIdAndClasses.CAMERA_START_BUTTON_ID);\n        cameraActionStartButton.innerText\n            = Html5QrcodeScannerStrings.scanButtonStartScanningText();\n        cameraActionContainer.appendChild(cameraActionStartButton);\n        var cameraActionStopButton = BaseUiElementFactory.createElement(\"button\", PublicUiElementIdAndClasses.CAMERA_STOP_BUTTON_ID);\n        cameraActionStopButton.innerText\n            = Html5QrcodeScannerStrings.scanButtonStopScanningText();\n        cameraActionStopButton.style.display = \"none\";\n        cameraActionStopButton.disabled = true;\n        cameraActionContainer.appendChild(cameraActionStopButton);\n        var torchButton;\n        var createAndShowTorchButtonIfSupported = function (cameraCapabilities) {\n            if (!cameraCapabilities.torchFeature().isSupported()) {\n                if (torchButton) {\n                    torchButton.hide();\n                }\n                return;\n            }\n            if (!torchButton) {\n                torchButton = TorchButton.create(cameraActionContainer, cameraCapabilities.torchFeature(), { display: \"none\", marginLeft: \"5px\" }, function (errorMessage) {\n                    $this.setHeaderMessage(errorMessage, Html5QrcodeScannerStatus.STATUS_WARNING);\n                });\n            }\n            else {\n                torchButton.updateTorchCapability(cameraCapabilities.torchFeature());\n            }\n            torchButton.show();\n        };\n        scpCameraScanRegion.appendChild(cameraActionContainer);\n        var resetCameraActionStartButton = function (shouldShow) {\n            if (!shouldShow) {\n                cameraActionStartButton.style.display = \"none\";\n            }\n            cameraActionStartButton.innerText\n                = Html5QrcodeScannerStrings\n                    .scanButtonStartScanningText();\n            cameraActionStartButton.style.opacity = \"1\";\n            cameraActionStartButton.disabled = false;\n            if (shouldShow) {\n                cameraActionStartButton.style.display = \"inline-block\";\n            }\n        };\n        cameraActionStartButton.addEventListener(\"click\", function (_) {\n            cameraActionStartButton.innerText\n                = Html5QrcodeScannerStrings.scanButtonScanningStarting();\n            cameraSelectUi.disable();\n            cameraActionStartButton.disabled = true;\n            cameraActionStartButton.style.opacity = \"0.5\";\n            if (_this.scanTypeSelector.hasMoreThanOneScanType()) {\n                $this.showHideScanTypeSwapLink(false);\n            }\n            $this.resetHeaderMessage();\n            var cameraId = cameraSelectUi.getValue();\n            $this.persistedDataManager.setLastUsedCameraId(cameraId);\n            $this.html5Qrcode.start(cameraId, toHtml5QrcodeCameraScanConfig($this.config), $this.qrCodeSuccessCallback, $this.qrCodeErrorCallback)\n                .then(function (_) {\n                cameraActionStopButton.disabled = false;\n                cameraActionStopButton.style.display = \"inline-block\";\n                resetCameraActionStartButton(false);\n                var cameraCapabilities = $this.html5Qrcode.getRunningTrackCameraCapabilities();\n                if (_this.config.showTorchButtonIfSupported === true) {\n                    createAndShowTorchButtonIfSupported(cameraCapabilities);\n                }\n                if (_this.config.showZoomSliderIfSupported === true) {\n                    renderCameraZoomUiIfSupported(cameraCapabilities);\n                }\n            })\n                .catch(function (error) {\n                $this.showHideScanTypeSwapLink(true);\n                cameraSelectUi.enable();\n                resetCameraActionStartButton(true);\n                $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n            });\n        });\n        if (cameraSelectUi.hasSingleItem()) {\n            cameraActionStartButton.click();\n        }\n        cameraActionStopButton.addEventListener(\"click\", function (_) {\n            if (!$this.html5Qrcode) {\n                throw \"html5Qrcode not defined\";\n            }\n            cameraActionStopButton.disabled = true;\n            $this.html5Qrcode.stop()\n                .then(function (_) {\n                if (_this.scanTypeSelector.hasMoreThanOneScanType()) {\n                    $this.showHideScanTypeSwapLink(true);\n                }\n                cameraSelectUi.enable();\n                cameraActionStartButton.disabled = false;\n                cameraActionStopButton.style.display = \"none\";\n                cameraActionStartButton.style.display = \"inline-block\";\n                if (torchButton) {\n                    torchButton.reset();\n                    torchButton.hide();\n                }\n                cameraZoomUi.removeOnCameraZoomValueChangeCallback();\n                cameraZoomUi.hide();\n                $this.insertCameraScanImageToScanRegion();\n            }).catch(function (error) {\n                cameraActionStopButton.disabled = false;\n                $this.setHeaderMessage(error, Html5QrcodeScannerStatus.STATUS_WARNING);\n            });\n        });\n        if ($this.persistedDataManager.getLastUsedCameraId()) {\n            var cameraId = $this.persistedDataManager.getLastUsedCameraId();\n            if (cameraSelectUi.hasValue(cameraId)) {\n                cameraSelectUi.setValue(cameraId);\n                cameraActionStartButton.click();\n            }\n            else {\n                $this.persistedDataManager.resetLastUsedCameraId();\n            }\n        }\n    };\n    Html5QrcodeScanner.prototype.createSectionSwap = function () {\n        var $this = this;\n        var TEXT_IF_CAMERA_SCAN_SELECTED = Html5QrcodeScannerStrings.textIfCameraScanSelected();\n        var TEXT_IF_FILE_SCAN_SELECTED = Html5QrcodeScannerStrings.textIfFileScanSelected();\n        var section = document.getElementById(this.getDashboardSectionId());\n        var switchContainer = document.createElement(\"div\");\n        switchContainer.style.textAlign = \"center\";\n        var switchScanTypeLink = BaseUiElementFactory.createElement(\"span\", this.getDashboardSectionSwapLinkId());\n        switchScanTypeLink.style.textDecoration = \"underline\";\n        switchScanTypeLink.style.cursor = \"pointer\";\n        switchScanTypeLink.innerText\n            = ScanTypeSelector.isCameraScanType(this.currentScanType)\n                ? TEXT_IF_CAMERA_SCAN_SELECTED : TEXT_IF_FILE_SCAN_SELECTED;\n        switchScanTypeLink.addEventListener(\"click\", function () {\n            if (!$this.sectionSwapAllowed) {\n                if ($this.verbose) {\n                    $this.logger.logError(\"Section swap called when not allowed\");\n                }\n                return;\n            }\n            $this.resetHeaderMessage();\n            $this.fileSelectionUi.resetValue();\n            $this.sectionSwapAllowed = false;\n            if (ScanTypeSelector.isCameraScanType($this.currentScanType)) {\n                $this.clearScanRegion();\n                $this.getCameraScanRegion().style.display = \"none\";\n                $this.fileSelectionUi.show();\n                switchScanTypeLink.innerText = TEXT_IF_FILE_SCAN_SELECTED;\n                $this.currentScanType = Html5QrcodeScanType.SCAN_TYPE_FILE;\n                $this.insertFileScanImageToScanRegion();\n            }\n            else {\n                $this.clearScanRegion();\n                $this.getCameraScanRegion().style.display = \"block\";\n                $this.fileSelectionUi.hide();\n                switchScanTypeLink.innerText = TEXT_IF_CAMERA_SCAN_SELECTED;\n                $this.currentScanType = Html5QrcodeScanType.SCAN_TYPE_CAMERA;\n                $this.insertCameraScanImageToScanRegion();\n                $this.startCameraScanIfPermissionExistsOnSwap();\n            }\n            $this.sectionSwapAllowed = true;\n        });\n        switchContainer.appendChild(switchScanTypeLink);\n        section.appendChild(switchContainer);\n    };\n    Html5QrcodeScanner.prototype.startCameraScanIfPermissionExistsOnSwap = function () {\n        var _this = this;\n        var $this = this;\n        if (this.persistedDataManager.hasCameraPermissions()) {\n            CameraPermissions.hasPermissions().then(function (hasPermissions) {\n                if (hasPermissions) {\n                    var permissionButton = document.getElementById($this.getCameraPermissionButtonId());\n                    if (!permissionButton) {\n                        _this.logger.logError(\"Permission button not found, fail;\");\n                        throw \"Permission button not found\";\n                    }\n                    permissionButton.click();\n                }\n                else {\n                    $this.persistedDataManager.setHasPermission(false);\n                }\n            }).catch(function (_) {\n                $this.persistedDataManager.setHasPermission(false);\n            });\n            return;\n        }\n    };\n    Html5QrcodeScanner.prototype.resetHeaderMessage = function () {\n        var messageDiv = document.getElementById(this.getHeaderMessageContainerId());\n        messageDiv.style.display = \"none\";\n    };\n    Html5QrcodeScanner.prototype.setHeaderMessage = function (messageText, scannerStatus) {\n        if (!scannerStatus) {\n            scannerStatus = Html5QrcodeScannerStatus.STATUS_DEFAULT;\n        }\n        var messageDiv = this.getHeaderMessageDiv();\n        messageDiv.innerText = messageText;\n        messageDiv.style.display = \"block\";\n        switch (scannerStatus) {\n            case Html5QrcodeScannerStatus.STATUS_SUCCESS:\n                messageDiv.style.background = \"rgba(106, 175, 80, 0.26)\";\n                messageDiv.style.color = \"#477735\";\n                break;\n            case Html5QrcodeScannerStatus.STATUS_WARNING:\n                messageDiv.style.background = \"rgba(203, 36, 49, 0.14)\";\n                messageDiv.style.color = \"#cb2431\";\n                break;\n            case Html5QrcodeScannerStatus.STATUS_DEFAULT:\n            default:\n                messageDiv.style.background = \"rgba(0, 0, 0, 0)\";\n                messageDiv.style.color = \"rgb(17, 17, 17)\";\n                break;\n        }\n    };\n    Html5QrcodeScanner.prototype.showHideScanTypeSwapLink = function (shouldDisplay) {\n        if (this.scanTypeSelector.hasMoreThanOneScanType()) {\n            if (shouldDisplay !== true) {\n                shouldDisplay = false;\n            }\n            this.sectionSwapAllowed = shouldDisplay;\n            this.getDashboardSectionSwapLink().style.display\n                = shouldDisplay ? \"inline-block\" : \"none\";\n        }\n    };\n    Html5QrcodeScanner.prototype.insertCameraScanImageToScanRegion = function () {\n        var $this = this;\n        var qrCodeScanRegion = document.getElementById(this.getScanRegionId());\n        if (this.cameraScanImage) {\n            qrCodeScanRegion.innerHTML = \"<br>\";\n            qrCodeScanRegion.appendChild(this.cameraScanImage);\n            return;\n        }\n        this.cameraScanImage = new Image;\n        this.cameraScanImage.onload = function (_) {\n            qrCodeScanRegion.innerHTML = \"<br>\";\n            qrCodeScanRegion.appendChild($this.cameraScanImage);\n        };\n        this.cameraScanImage.width = 64;\n        this.cameraScanImage.style.opacity = \"0.8\";\n        this.cameraScanImage.src = ASSET_CAMERA_SCAN;\n        this.cameraScanImage.alt = Html5QrcodeScannerStrings.cameraScanAltText();\n    };\n    Html5QrcodeScanner.prototype.insertFileScanImageToScanRegion = function () {\n        var $this = this;\n        var qrCodeScanRegion = document.getElementById(this.getScanRegionId());\n        if (this.fileScanImage) {\n            qrCodeScanRegion.innerHTML = \"<br>\";\n            qrCodeScanRegion.appendChild(this.fileScanImage);\n            return;\n        }\n        this.fileScanImage = new Image;\n        this.fileScanImage.onload = function (_) {\n            qrCodeScanRegion.innerHTML = \"<br>\";\n            qrCodeScanRegion.appendChild($this.fileScanImage);\n        };\n        this.fileScanImage.width = 64;\n        this.fileScanImage.style.opacity = \"0.8\";\n        this.fileScanImage.src = ASSET_FILE_SCAN;\n        this.fileScanImage.alt = Html5QrcodeScannerStrings.fileScanAltText();\n    };\n    Html5QrcodeScanner.prototype.clearScanRegion = function () {\n        var qrCodeScanRegion = document.getElementById(this.getScanRegionId());\n        qrCodeScanRegion.innerHTML = \"\";\n    };\n    Html5QrcodeScanner.prototype.getDashboardSectionId = function () {\n        return \"\".concat(this.elementId, \"__dashboard_section\");\n    };\n    Html5QrcodeScanner.prototype.getDashboardSectionCameraScanRegionId = function () {\n        return \"\".concat(this.elementId, \"__dashboard_section_csr\");\n    };\n    Html5QrcodeScanner.prototype.getDashboardSectionSwapLinkId = function () {\n        return PublicUiElementIdAndClasses.SCAN_TYPE_CHANGE_ANCHOR_ID;\n    };\n    Html5QrcodeScanner.prototype.getScanRegionId = function () {\n        return \"\".concat(this.elementId, \"__scan_region\");\n    };\n    Html5QrcodeScanner.prototype.getDashboardId = function () {\n        return \"\".concat(this.elementId, \"__dashboard\");\n    };\n    Html5QrcodeScanner.prototype.getHeaderMessageContainerId = function () {\n        return \"\".concat(this.elementId, \"__header_message\");\n    };\n    Html5QrcodeScanner.prototype.getCameraPermissionButtonId = function () {\n        return PublicUiElementIdAndClasses.CAMERA_PERMISSION_BUTTON_ID;\n    };\n    Html5QrcodeScanner.prototype.getCameraScanRegion = function () {\n        return document.getElementById(this.getDashboardSectionCameraScanRegionId());\n    };\n    Html5QrcodeScanner.prototype.getDashboardSectionSwapLink = function () {\n        return document.getElementById(this.getDashboardSectionSwapLinkId());\n    };\n    Html5QrcodeScanner.prototype.getHeaderMessageDiv = function () {\n        return document.getElementById(this.getHeaderMessageContainerId());\n    };\n    return Html5QrcodeScanner;\n}());\nexport { Html5QrcodeScanner };\n//# sourceMappingURL=html5-qrcode-scanner.js.map"]},"metadata":{},"sourceType":"module"}