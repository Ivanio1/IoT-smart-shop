{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar AbstractCameraCapability = function () {\n  function AbstractCameraCapability(name, track) {\n    this.name = name;\n    this.track = track;\n  }\n\n  AbstractCameraCapability.prototype.isSupported = function () {\n    if (!this.track.getCapabilities) {\n      return false;\n    }\n\n    return this.name in this.track.getCapabilities();\n  };\n\n  AbstractCameraCapability.prototype.apply = function (value) {\n    var constraint = {};\n    constraint[this.name] = value;\n    var constraints = {\n      advanced: [constraint]\n    };\n    return this.track.applyConstraints(constraints);\n  };\n\n  AbstractCameraCapability.prototype.value = function () {\n    var settings = this.track.getSettings();\n\n    if (this.name in settings) {\n      var settingValue = settings[this.name];\n      return settingValue;\n    }\n\n    return null;\n  };\n\n  return AbstractCameraCapability;\n}();\n\nvar AbstractRangeCameraCapability = function (_super) {\n  __extends(AbstractRangeCameraCapability, _super);\n\n  function AbstractRangeCameraCapability(name, track) {\n    return _super.call(this, name, track) || this;\n  }\n\n  AbstractRangeCameraCapability.prototype.min = function () {\n    return this.getCapabilities().min;\n  };\n\n  AbstractRangeCameraCapability.prototype.max = function () {\n    return this.getCapabilities().max;\n  };\n\n  AbstractRangeCameraCapability.prototype.step = function () {\n    return this.getCapabilities().step;\n  };\n\n  AbstractRangeCameraCapability.prototype.apply = function (value) {\n    var constraint = {};\n    constraint[this.name] = value;\n    var constraints = {\n      advanced: [constraint]\n    };\n    return this.track.applyConstraints(constraints);\n  };\n\n  AbstractRangeCameraCapability.prototype.getCapabilities = function () {\n    this.failIfNotSupported();\n    var capabilities = this.track.getCapabilities();\n    var capability = capabilities[this.name];\n    return {\n      min: capability.min,\n      max: capability.max,\n      step: capability.step\n    };\n  };\n\n  AbstractRangeCameraCapability.prototype.failIfNotSupported = function () {\n    if (!this.isSupported()) {\n      throw new Error(\"\".concat(this.name, \" capability not supported\"));\n    }\n  };\n\n  return AbstractRangeCameraCapability;\n}(AbstractCameraCapability);\n\nvar ZoomFeatureImpl = function (_super) {\n  __extends(ZoomFeatureImpl, _super);\n\n  function ZoomFeatureImpl(track) {\n    return _super.call(this, \"zoom\", track) || this;\n  }\n\n  return ZoomFeatureImpl;\n}(AbstractRangeCameraCapability);\n\nvar TorchFeatureImpl = function (_super) {\n  __extends(TorchFeatureImpl, _super);\n\n  function TorchFeatureImpl(track) {\n    return _super.call(this, \"torch\", track) || this;\n  }\n\n  return TorchFeatureImpl;\n}(AbstractCameraCapability);\n\nvar CameraCapabilitiesImpl = function () {\n  function CameraCapabilitiesImpl(track) {\n    this.track = track;\n  }\n\n  CameraCapabilitiesImpl.prototype.zoomFeature = function () {\n    return new ZoomFeatureImpl(this.track);\n  };\n\n  CameraCapabilitiesImpl.prototype.torchFeature = function () {\n    return new TorchFeatureImpl(this.track);\n  };\n\n  return CameraCapabilitiesImpl;\n}();\n\nvar RenderedCameraImpl = function () {\n  function RenderedCameraImpl(parentElement, mediaStream, callbacks) {\n    this.isClosed = false;\n    this.parentElement = parentElement;\n    this.mediaStream = mediaStream;\n    this.callbacks = callbacks;\n    this.surface = this.createVideoElement(this.parentElement.clientWidth);\n    parentElement.append(this.surface);\n  }\n\n  RenderedCameraImpl.prototype.createVideoElement = function (width) {\n    var videoElement = document.createElement(\"video\");\n    videoElement.style.width = \"\".concat(width, \"px\");\n    videoElement.style.display = \"block\";\n    videoElement.muted = true;\n    videoElement.setAttribute(\"muted\", \"true\");\n    videoElement.playsInline = true;\n    return videoElement;\n  };\n\n  RenderedCameraImpl.prototype.setupSurface = function () {\n    var _this = this;\n\n    this.surface.onabort = function () {\n      throw \"RenderedCameraImpl video surface onabort() called\";\n    };\n\n    this.surface.onerror = function () {\n      throw \"RenderedCameraImpl video surface onerror() called\";\n    };\n\n    var onVideoStart = function () {\n      var videoWidth = _this.surface.clientWidth;\n      var videoHeight = _this.surface.clientHeight;\n\n      _this.callbacks.onRenderSurfaceReady(videoWidth, videoHeight);\n\n      _this.surface.removeEventListener(\"playing\", onVideoStart);\n    };\n\n    this.surface.addEventListener(\"playing\", onVideoStart);\n    this.surface.srcObject = this.mediaStream;\n    this.surface.play();\n  };\n\n  RenderedCameraImpl.create = function (parentElement, mediaStream, options, callbacks) {\n    return __awaiter(this, void 0, void 0, function () {\n      var renderedCamera, aspectRatioConstraint;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            renderedCamera = new RenderedCameraImpl(parentElement, mediaStream, callbacks);\n            if (!options.aspectRatio) return [3, 2];\n            aspectRatioConstraint = {\n              aspectRatio: options.aspectRatio\n            };\n            return [4, renderedCamera.getFirstTrackOrFail().applyConstraints(aspectRatioConstraint)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            renderedCamera.setupSurface();\n            return [2, renderedCamera];\n        }\n      });\n    });\n  };\n\n  RenderedCameraImpl.prototype.failIfClosed = function () {\n    if (this.isClosed) {\n      throw \"The RenderedCamera has already been closed.\";\n    }\n  };\n\n  RenderedCameraImpl.prototype.getFirstTrackOrFail = function () {\n    this.failIfClosed();\n\n    if (this.mediaStream.getVideoTracks().length === 0) {\n      throw \"No video tracks found\";\n    }\n\n    return this.mediaStream.getVideoTracks()[0];\n  };\n\n  RenderedCameraImpl.prototype.pause = function () {\n    this.failIfClosed();\n    this.surface.pause();\n  };\n\n  RenderedCameraImpl.prototype.resume = function (onResumeCallback) {\n    this.failIfClosed();\n    var $this = this;\n\n    var onVideoResume = function () {\n      setTimeout(onResumeCallback, 200);\n      $this.surface.removeEventListener(\"playing\", onVideoResume);\n    };\n\n    this.surface.addEventListener(\"playing\", onVideoResume);\n    this.surface.play();\n  };\n\n  RenderedCameraImpl.prototype.isPaused = function () {\n    this.failIfClosed();\n    return this.surface.paused;\n  };\n\n  RenderedCameraImpl.prototype.getSurface = function () {\n    this.failIfClosed();\n    return this.surface;\n  };\n\n  RenderedCameraImpl.prototype.getRunningTrackCapabilities = function () {\n    return this.getFirstTrackOrFail().getCapabilities();\n  };\n\n  RenderedCameraImpl.prototype.getRunningTrackSettings = function () {\n    return this.getFirstTrackOrFail().getSettings();\n  };\n\n  RenderedCameraImpl.prototype.applyVideoConstraints = function (constraints) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (\"aspectRatio\" in constraints) {\n          throw \"Changing 'aspectRatio' in run-time is not yet supported.\";\n        }\n\n        return [2, this.getFirstTrackOrFail().applyConstraints(constraints)];\n      });\n    });\n  };\n\n  RenderedCameraImpl.prototype.close = function () {\n    if (this.isClosed) {\n      return Promise.resolve();\n    }\n\n    var $this = this;\n    return new Promise(function (resolve, _) {\n      var tracks = $this.mediaStream.getVideoTracks();\n      var tracksToClose = tracks.length;\n      var tracksClosed = 0;\n      $this.mediaStream.getVideoTracks().forEach(function (videoTrack) {\n        $this.mediaStream.removeTrack(videoTrack);\n        videoTrack.stop();\n        ++tracksClosed;\n\n        if (tracksClosed >= tracksToClose) {\n          $this.isClosed = true;\n          $this.parentElement.removeChild($this.surface);\n          resolve();\n        }\n      });\n    });\n  };\n\n  RenderedCameraImpl.prototype.getCapabilities = function () {\n    return new CameraCapabilitiesImpl(this.getFirstTrackOrFail());\n  };\n\n  return RenderedCameraImpl;\n}();\n\nvar CameraImpl = function () {\n  function CameraImpl(mediaStream) {\n    this.mediaStream = mediaStream;\n  }\n\n  CameraImpl.prototype.render = function (parentElement, options, callbacks) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2, RenderedCameraImpl.create(parentElement, this.mediaStream, options, callbacks)];\n      });\n    });\n  };\n\n  CameraImpl.create = function (videoConstraints) {\n    return __awaiter(this, void 0, void 0, function () {\n      var constraints, mediaStream;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!navigator.mediaDevices) {\n              throw \"navigator.mediaDevices not supported\";\n            }\n\n            constraints = {\n              audio: false,\n              video: videoConstraints\n            };\n            return [4, navigator.mediaDevices.getUserMedia(constraints)];\n\n          case 1:\n            mediaStream = _a.sent();\n            return [2, new CameraImpl(mediaStream)];\n        }\n      });\n    });\n  };\n\n  return CameraImpl;\n}();\n\nexport { CameraImpl };","map":{"version":3,"sources":["../../../src/camera/core-impl.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar AbstractCameraCapability = (function () {\n    function AbstractCameraCapability(name, track) {\n        this.name = name;\n        this.track = track;\n    }\n    AbstractCameraCapability.prototype.isSupported = function () {\n        if (!this.track.getCapabilities) {\n            return false;\n        }\n        return this.name in this.track.getCapabilities();\n    };\n    AbstractCameraCapability.prototype.apply = function (value) {\n        var constraint = {};\n        constraint[this.name] = value;\n        var constraints = { advanced: [constraint] };\n        return this.track.applyConstraints(constraints);\n    };\n    AbstractCameraCapability.prototype.value = function () {\n        var settings = this.track.getSettings();\n        if (this.name in settings) {\n            var settingValue = settings[this.name];\n            return settingValue;\n        }\n        return null;\n    };\n    return AbstractCameraCapability;\n}());\nvar AbstractRangeCameraCapability = (function (_super) {\n    __extends(AbstractRangeCameraCapability, _super);\n    function AbstractRangeCameraCapability(name, track) {\n        return _super.call(this, name, track) || this;\n    }\n    AbstractRangeCameraCapability.prototype.min = function () {\n        return this.getCapabilities().min;\n    };\n    AbstractRangeCameraCapability.prototype.max = function () {\n        return this.getCapabilities().max;\n    };\n    AbstractRangeCameraCapability.prototype.step = function () {\n        return this.getCapabilities().step;\n    };\n    AbstractRangeCameraCapability.prototype.apply = function (value) {\n        var constraint = {};\n        constraint[this.name] = value;\n        var constraints = { advanced: [constraint] };\n        return this.track.applyConstraints(constraints);\n    };\n    AbstractRangeCameraCapability.prototype.getCapabilities = function () {\n        this.failIfNotSupported();\n        var capabilities = this.track.getCapabilities();\n        var capability = capabilities[this.name];\n        return {\n            min: capability.min,\n            max: capability.max,\n            step: capability.step,\n        };\n    };\n    AbstractRangeCameraCapability.prototype.failIfNotSupported = function () {\n        if (!this.isSupported()) {\n            throw new Error(\"\".concat(this.name, \" capability not supported\"));\n        }\n    };\n    return AbstractRangeCameraCapability;\n}(AbstractCameraCapability));\nvar ZoomFeatureImpl = (function (_super) {\n    __extends(ZoomFeatureImpl, _super);\n    function ZoomFeatureImpl(track) {\n        return _super.call(this, \"zoom\", track) || this;\n    }\n    return ZoomFeatureImpl;\n}(AbstractRangeCameraCapability));\nvar TorchFeatureImpl = (function (_super) {\n    __extends(TorchFeatureImpl, _super);\n    function TorchFeatureImpl(track) {\n        return _super.call(this, \"torch\", track) || this;\n    }\n    return TorchFeatureImpl;\n}(AbstractCameraCapability));\nvar CameraCapabilitiesImpl = (function () {\n    function CameraCapabilitiesImpl(track) {\n        this.track = track;\n    }\n    CameraCapabilitiesImpl.prototype.zoomFeature = function () {\n        return new ZoomFeatureImpl(this.track);\n    };\n    CameraCapabilitiesImpl.prototype.torchFeature = function () {\n        return new TorchFeatureImpl(this.track);\n    };\n    return CameraCapabilitiesImpl;\n}());\nvar RenderedCameraImpl = (function () {\n    function RenderedCameraImpl(parentElement, mediaStream, callbacks) {\n        this.isClosed = false;\n        this.parentElement = parentElement;\n        this.mediaStream = mediaStream;\n        this.callbacks = callbacks;\n        this.surface = this.createVideoElement(this.parentElement.clientWidth);\n        parentElement.append(this.surface);\n    }\n    RenderedCameraImpl.prototype.createVideoElement = function (width) {\n        var videoElement = document.createElement(\"video\");\n        videoElement.style.width = \"\".concat(width, \"px\");\n        videoElement.style.display = \"block\";\n        videoElement.muted = true;\n        videoElement.setAttribute(\"muted\", \"true\");\n        videoElement.playsInline = true;\n        return videoElement;\n    };\n    RenderedCameraImpl.prototype.setupSurface = function () {\n        var _this = this;\n        this.surface.onabort = function () {\n            throw \"RenderedCameraImpl video surface onabort() called\";\n        };\n        this.surface.onerror = function () {\n            throw \"RenderedCameraImpl video surface onerror() called\";\n        };\n        var onVideoStart = function () {\n            var videoWidth = _this.surface.clientWidth;\n            var videoHeight = _this.surface.clientHeight;\n            _this.callbacks.onRenderSurfaceReady(videoWidth, videoHeight);\n            _this.surface.removeEventListener(\"playing\", onVideoStart);\n        };\n        this.surface.addEventListener(\"playing\", onVideoStart);\n        this.surface.srcObject = this.mediaStream;\n        this.surface.play();\n    };\n    RenderedCameraImpl.create = function (parentElement, mediaStream, options, callbacks) {\n        return __awaiter(this, void 0, void 0, function () {\n            var renderedCamera, aspectRatioConstraint;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        renderedCamera = new RenderedCameraImpl(parentElement, mediaStream, callbacks);\n                        if (!options.aspectRatio) return [3, 2];\n                        aspectRatioConstraint = {\n                            aspectRatio: options.aspectRatio\n                        };\n                        return [4, renderedCamera.getFirstTrackOrFail().applyConstraints(aspectRatioConstraint)];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        renderedCamera.setupSurface();\n                        return [2, renderedCamera];\n                }\n            });\n        });\n    };\n    RenderedCameraImpl.prototype.failIfClosed = function () {\n        if (this.isClosed) {\n            throw \"The RenderedCamera has already been closed.\";\n        }\n    };\n    RenderedCameraImpl.prototype.getFirstTrackOrFail = function () {\n        this.failIfClosed();\n        if (this.mediaStream.getVideoTracks().length === 0) {\n            throw \"No video tracks found\";\n        }\n        return this.mediaStream.getVideoTracks()[0];\n    };\n    RenderedCameraImpl.prototype.pause = function () {\n        this.failIfClosed();\n        this.surface.pause();\n    };\n    RenderedCameraImpl.prototype.resume = function (onResumeCallback) {\n        this.failIfClosed();\n        var $this = this;\n        var onVideoResume = function () {\n            setTimeout(onResumeCallback, 200);\n            $this.surface.removeEventListener(\"playing\", onVideoResume);\n        };\n        this.surface.addEventListener(\"playing\", onVideoResume);\n        this.surface.play();\n    };\n    RenderedCameraImpl.prototype.isPaused = function () {\n        this.failIfClosed();\n        return this.surface.paused;\n    };\n    RenderedCameraImpl.prototype.getSurface = function () {\n        this.failIfClosed();\n        return this.surface;\n    };\n    RenderedCameraImpl.prototype.getRunningTrackCapabilities = function () {\n        return this.getFirstTrackOrFail().getCapabilities();\n    };\n    RenderedCameraImpl.prototype.getRunningTrackSettings = function () {\n        return this.getFirstTrackOrFail().getSettings();\n    };\n    RenderedCameraImpl.prototype.applyVideoConstraints = function (constraints) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (\"aspectRatio\" in constraints) {\n                    throw \"Changing 'aspectRatio' in run-time is not yet supported.\";\n                }\n                return [2, this.getFirstTrackOrFail().applyConstraints(constraints)];\n            });\n        });\n    };\n    RenderedCameraImpl.prototype.close = function () {\n        if (this.isClosed) {\n            return Promise.resolve();\n        }\n        var $this = this;\n        return new Promise(function (resolve, _) {\n            var tracks = $this.mediaStream.getVideoTracks();\n            var tracksToClose = tracks.length;\n            var tracksClosed = 0;\n            $this.mediaStream.getVideoTracks().forEach(function (videoTrack) {\n                $this.mediaStream.removeTrack(videoTrack);\n                videoTrack.stop();\n                ++tracksClosed;\n                if (tracksClosed >= tracksToClose) {\n                    $this.isClosed = true;\n                    $this.parentElement.removeChild($this.surface);\n                    resolve();\n                }\n            });\n        });\n    };\n    RenderedCameraImpl.prototype.getCapabilities = function () {\n        return new CameraCapabilitiesImpl(this.getFirstTrackOrFail());\n    };\n    return RenderedCameraImpl;\n}());\nvar CameraImpl = (function () {\n    function CameraImpl(mediaStream) {\n        this.mediaStream = mediaStream;\n    }\n    CameraImpl.prototype.render = function (parentElement, options, callbacks) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, RenderedCameraImpl.create(parentElement, this.mediaStream, options, callbacks)];\n            });\n        });\n    };\n    CameraImpl.create = function (videoConstraints) {\n        return __awaiter(this, void 0, void 0, function () {\n            var constraints, mediaStream;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!navigator.mediaDevices) {\n                            throw \"navigator.mediaDevices not supported\";\n                        }\n                        constraints = {\n                            audio: false,\n                            video: videoConstraints\n                        };\n                        return [4, navigator.mediaDevices.getUserMedia(constraints)];\n                    case 1:\n                        mediaStream = _a.sent();\n                        return [2, new CameraImpl(mediaStream)];\n                }\n            });\n        });\n    };\n    return CameraImpl;\n}());\nexport { CameraImpl };\n//# sourceMappingURL=core-impl.js.map"]},"metadata":{},"sourceType":"module"}