{"ast":null,"code":"import { observable, decorate } from \"mobx\";\nimport { RequestState } from \"types/RequestState\";\nclass UserStore {\n  constructor() {\n    this.user = null;\n    this.state = RequestState.PENDING;\n    this.loginVk = code => {\n      this.state = RequestState.LOADING;\n      return fetch(`${process.env.REACT_APP_API_HOST}/auth/login/vk`, {\n        method: \"POST\",\n        body: JSON.stringify({\n          code\n        }),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }).then(res => {\n        switch (res.status) {\n          case 200:\n          case 201:\n            return res.json();\n          default:\n            this.setError();\n            return Promise.reject();\n        }\n      }).then(user => this.setUser(user));\n    };\n    this.getProfile = () => {\n      this.state = RequestState.LOADING;\n      const token = sessionStorage.getItem(\"token\");\n      if (!token) Promise.reject();\n      return fetch(`${process.env.REACT_APP_API_HOST}/users/profile`, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`\n        }\n      }).then(res => {\n        switch (res.status) {\n          case 200:\n          case 201:\n            return res.json();\n          default:\n            this.setError();\n            return Promise.reject();\n        }\n      }).then(user => this.setUser(user));\n    };\n    this.logout = () => {\n      this.user = null;\n      sessionStorage.clear();\n      this.state = RequestState.PENDING;\n    };\n    this.setUser = user => {\n      this.user = user;\n      this.state = RequestState.SUCCESS;\n      if (user[\"token\"]) {\n        sessionStorage.setItem(\"token\", user.token);\n      }\n    };\n    this.setError = () => {\n      this.state = RequestState.ERROR;\n    };\n  }\n}\ndecorate(UserStore, {\n  user: observable,\n  state: observable\n});\nexport default new UserStore();","map":{"version":3,"names":["observable","decorate","RequestState","UserStore","constructor","user","state","PENDING","loginVk","code","LOADING","fetch","process","env","REACT_APP_API_HOST","method","body","JSON","stringify","headers","then","res","status","json","setError","Promise","reject","setUser","getProfile","token","sessionStorage","getItem","Authorization","logout","clear","SUCCESS","setItem","ERROR"],"sources":["/Users/moyakkauntda/IdeaProjects/IoT-smart-shop/user-app/src/stores/UserStore.ts"],"sourcesContent":["import { observable, decorate } from \"mobx\";\n\nimport { RequestState } from \"types/RequestState\";\n\nexport interface IUser {\n  id: number;\n  email: string;\n  grant: number;\n  name: string;\n  token: string;\n  avatar_url: string | null;\n}\n\nclass UserStore {\n  user: IUser = null;\n  state = RequestState.PENDING;\n\n  loginVk = (code: string) => {\n    this.state = RequestState.LOADING;\n\n    return fetch(`${process.env.REACT_APP_API_HOST}/auth/login/vk`, {\n      method: \"POST\",\n      body: JSON.stringify({ code }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n      .then((res) => {\n        switch (res.status) {\n          case 200:\n          case 201:\n            return res.json();\n          default:\n            this.setError();\n            return Promise.reject();\n        }\n      })\n      .then((user) => this.setUser(user));\n  };\n\n  getProfile = () => {\n    this.state = RequestState.LOADING;\n    const token = sessionStorage.getItem(\"token\");\n\n    if (!token) Promise.reject();\n\n    return fetch(`${process.env.REACT_APP_API_HOST}/users/profile`, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${token}`,\n      },\n    })\n      .then((res) => {\n        switch (res.status) {\n          case 200:\n          case 201:\n            return res.json();\n          default:\n            this.setError();\n            return Promise.reject();\n        }\n      })\n      .then((user) => this.setUser(user));\n  };\n\n  logout = () => {\n    this.user = null;\n    sessionStorage.clear();\n    this.state = RequestState.PENDING;\n  };\n\n  setUser = (user: IUser) => {\n    this.user = user;\n    this.state = RequestState.SUCCESS;\n\n    if (user[\"token\"]) {\n      sessionStorage.setItem(\"token\", user.token);\n    }\n  };\n\n  setError = () => {\n    this.state = RequestState.ERROR;\n  };\n}\n\ndecorate(UserStore, {\n  user: observable,\n  state: observable,\n});\n\nexport default new UserStore();\n"],"mappings":"AAAA,SAASA,UAAU,EAAEC,QAAQ,QAAQ,MAAM;AAE3C,SAASC,YAAY,QAAQ,oBAAoB;AAWjD,MAAMC,SAAS,CAAC;EAAAC,YAAA;IAAA,KACdC,IAAI,GAAU,IAAI;IAAA,KAClBC,KAAK,GAAGJ,YAAY,CAACK,OAAO;IAAA,KAE5BC,OAAO,GAAIC,IAAY,IAAK;MAC1B,IAAI,CAACH,KAAK,GAAGJ,YAAY,CAACQ,OAAO;MAEjC,OAAOC,KAAK,CAAE,GAAEC,OAAO,CAACC,GAAG,CAACC,kBAAmB,gBAAe,EAAE;QAC9DC,MAAM,EAAE,MAAM;QACdC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UAAET;QAAK,CAAC,CAAC;QAC9BU,OAAO,EAAE;UACP,cAAc,EAAE;QAClB;MACF,CAAC,CAAC,CACCC,IAAI,CAAEC,GAAG,IAAK;QACb,QAAQA,GAAG,CAACC,MAAM;UAChB,KAAK,GAAG;UACR,KAAK,GAAG;YACN,OAAOD,GAAG,CAACE,IAAI,CAAC,CAAC;UACnB;YACE,IAAI,CAACC,QAAQ,CAAC,CAAC;YACf,OAAOC,OAAO,CAACC,MAAM,CAAC,CAAC;QAC3B;MACF,CAAC,CAAC,CACDN,IAAI,CAAEf,IAAI,IAAK,IAAI,CAACsB,OAAO,CAACtB,IAAI,CAAC,CAAC;IACvC,CAAC;IAAA,KAEDuB,UAAU,GAAG,MAAM;MACjB,IAAI,CAACtB,KAAK,GAAGJ,YAAY,CAACQ,OAAO;MACjC,MAAMmB,KAAK,GAAGC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC;MAE7C,IAAI,CAACF,KAAK,EAAEJ,OAAO,CAACC,MAAM,CAAC,CAAC;MAE5B,OAAOf,KAAK,CAAE,GAAEC,OAAO,CAACC,GAAG,CAACC,kBAAmB,gBAAe,EAAE;QAC9DK,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClCa,aAAa,EAAG,UAASH,KAAM;QACjC;MACF,CAAC,CAAC,CACCT,IAAI,CAAEC,GAAG,IAAK;QACb,QAAQA,GAAG,CAACC,MAAM;UAChB,KAAK,GAAG;UACR,KAAK,GAAG;YACN,OAAOD,GAAG,CAACE,IAAI,CAAC,CAAC;UACnB;YACE,IAAI,CAACC,QAAQ,CAAC,CAAC;YACf,OAAOC,OAAO,CAACC,MAAM,CAAC,CAAC;QAC3B;MACF,CAAC,CAAC,CACDN,IAAI,CAAEf,IAAI,IAAK,IAAI,CAACsB,OAAO,CAACtB,IAAI,CAAC,CAAC;IACvC,CAAC;IAAA,KAED4B,MAAM,GAAG,MAAM;MACb,IAAI,CAAC5B,IAAI,GAAG,IAAI;MAChByB,cAAc,CAACI,KAAK,CAAC,CAAC;MACtB,IAAI,CAAC5B,KAAK,GAAGJ,YAAY,CAACK,OAAO;IACnC,CAAC;IAAA,KAEDoB,OAAO,GAAItB,IAAW,IAAK;MACzB,IAAI,CAACA,IAAI,GAAGA,IAAI;MAChB,IAAI,CAACC,KAAK,GAAGJ,YAAY,CAACiC,OAAO;MAEjC,IAAI9B,IAAI,CAAC,OAAO,CAAC,EAAE;QACjByB,cAAc,CAACM,OAAO,CAAC,OAAO,EAAE/B,IAAI,CAACwB,KAAK,CAAC;MAC7C;IACF,CAAC;IAAA,KAEDL,QAAQ,GAAG,MAAM;MACf,IAAI,CAAClB,KAAK,GAAGJ,YAAY,CAACmC,KAAK;IACjC,CAAC;EAAA;AACH;AAEApC,QAAQ,CAACE,SAAS,EAAE;EAClBE,IAAI,EAAEL,UAAU;EAChBM,KAAK,EAAEN;AACT,CAAC,CAAC;AAEF,eAAe,IAAIG,SAAS,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}