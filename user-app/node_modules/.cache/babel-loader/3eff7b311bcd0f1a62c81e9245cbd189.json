{"ast":null,"code":"var _jsxFileName = \"/Users/moyakkauntda/IdeaProjects/IoT-smart-shop/user-app/src/components/VKButton/index.tsx\";\nimport React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport { isEmptyObj } from \"helpers/isEmptyObj\";\nimport UserStore from \"stores/UserStore\";\nimport vk from \"./img/VK_Blue_Logo.svg\";\nimport styles from \"./VKButton.module.scss\";\nconst VKButton = props => {\n  const [isError, setIsError] = React.useState(false);\n  const host = process.env.REACT_APP_MODE === \"production\" ? process.env.REACT_APP_HOST_PROD : process.env.REACT_APP_HOST_LOCAL;\n  const cbLink = `${host}/signin`;\n  const handleRedirect = () => {\n    window.location.href = `https://oauth.vk.com/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&display=popup&redirect_uri=${cbLink}&scope=email&response_type=code&v=5.120&state=4194308`;\n  };\n  React.useEffect(() => {\n    const handleLogin = code => {\n      UserStore.loginVk(code).then(() => {\n        props.history.push(\"/user\");\n      }).catch(() => setIsError(true));\n    };\n    let queryObj = queryString.parse(props.location.search);\n\n    // if (isError) window.location.href = cbLink;\n\n    if (!isEmptyObj(queryObj) && queryObj[\"code\"]) handleLogin(queryObj.code);\n  }, [props.location.search, isError, cbLink, props.history]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles[\"vk-button\"],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: styles[\"vk-button__input\"],\n    onClick: handleRedirect,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: vk,\n    alt: \"vk logo\",\n    className: styles[\"vk-button__input-icon\"],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 9\n    }\n  }), \"\\u0412\\u043E\\u0439\\u0442\\u0438 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0412\\u043A\\u043E\\u043D\\u0442\\u0430\\u043A\\u0442\\u0435\"), isError && /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"red\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 19\n    }\n  }, \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0432\\u0445\\u043E\\u0434\\u0430 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0412\\u041A\"));\n};\nexport default withRouter(VKButton);","map":{"version":3,"names":["React","withRouter","queryString","isEmptyObj","UserStore","vk","styles","VKButton","props","isError","setIsError","useState","host","process","env","REACT_APP_MODE","REACT_APP_HOST_PROD","REACT_APP_HOST_LOCAL","cbLink","handleRedirect","window","location","href","REACT_APP_CLIENT_ID","useEffect","handleLogin","code","loginVk","then","history","push","catch","queryObj","parse","search","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onClick","src","alt","style","color"],"sources":["/Users/moyakkauntda/IdeaProjects/IoT-smart-shop/user-app/src/components/VKButton/index.tsx"],"sourcesContent":["import React from \"react\";\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\nimport queryString from \"query-string\";\n\nimport { isEmptyObj } from \"helpers/isEmptyObj\";\nimport UserStore from \"stores/UserStore\";\n\nimport vk from \"./img/VK_Blue_Logo.svg\";\n\nimport styles from \"./VKButton.module.scss\";\n\ninterface IProps extends RouteComponentProps {}\n\nconst VKButton: React.FC<IProps> = (props) => {\n  const [isError, setIsError] = React.useState(false);\n\n  const host =\n    process.env.REACT_APP_MODE === \"production\"\n      ? process.env.REACT_APP_HOST_PROD\n      : process.env.REACT_APP_HOST_LOCAL;\n\n  const cbLink = `${host}/signin`;\n\n  const handleRedirect = () => {\n    window.location.href = `https://oauth.vk.com/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&display=popup&redirect_uri=${cbLink}&scope=email&response_type=code&v=5.120&state=4194308`;\n  };\n\n  React.useEffect(() => {\n    const handleLogin = (code: string) => {\n      UserStore.loginVk(code)\n        .then(() => {\n          props.history.push(\"/user\");\n        })\n        .catch(() => setIsError(true));\n    };\n\n    let queryObj = queryString.parse(props.location.search);\n\n   // if (isError) window.location.href = cbLink;\n\n    if (!isEmptyObj(queryObj) && queryObj[\"code\"]) handleLogin(queryObj.code);\n  }, [props.location.search, isError, cbLink, props.history]);\n\n  return (\n    <div className={styles[\"vk-button\"]}>\n      <button className={styles[\"vk-button__input\"]} onClick={handleRedirect}>\n        <img\n          src={vk}\n          alt=\"vk logo\"\n          className={styles[\"vk-button__input-icon\"]}\n        />\n        Войти через Вконтакте\n      </button>\n      {isError && <p style={{ color: \"red\" }}>Ошибка входа через ВК</p>}\n    </div>\n  );\n};\n\nexport default withRouter(VKButton);\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,UAAU,QAA6B,kBAAkB;AAClE,OAAOC,WAAW,MAAM,cAAc;AAEtC,SAASC,UAAU,QAAQ,oBAAoB;AAC/C,OAAOC,SAAS,MAAM,kBAAkB;AAAC,OAAAC,EAAA;AAIzC,OAAOC,MAAM,MAAM,wBAAwB;AAI3C,MAAMC,QAA0B,GAAIC,KAAK,IAAK;EAC5C,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGV,KAAK,CAACW,QAAQ,CAAC,KAAK,CAAC;EAEnD,MAAMC,IAAI,GACRC,OAAO,CAACC,GAAG,CAACC,cAAc,KAAK,YAAY,GACvCF,OAAO,CAACC,GAAG,CAACE,mBAAmB,GAC/BH,OAAO,CAACC,GAAG,CAACG,oBAAoB;EAEtC,MAAMC,MAAM,GAAI,GAAEN,IAAK,SAAQ;EAE/B,MAAMO,cAAc,GAAGA,CAAA,KAAM;IAC3BC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAI,4CAA2CT,OAAO,CAACC,GAAG,CAACS,mBAAoB,+BAA8BL,MAAO,uDAAsD;EAChM,CAAC;EAEDlB,KAAK,CAACwB,SAAS,CAAC,MAAM;IACpB,MAAMC,WAAW,GAAIC,IAAY,IAAK;MACpCtB,SAAS,CAACuB,OAAO,CAACD,IAAI,CAAC,CACpBE,IAAI,CAAC,MAAM;QACVpB,KAAK,CAACqB,OAAO,CAACC,IAAI,CAAC,OAAO,CAAC;MAC7B,CAAC,CAAC,CACDC,KAAK,CAAC,MAAMrB,UAAU,CAAC,IAAI,CAAC,CAAC;IAClC,CAAC;IAED,IAAIsB,QAAQ,GAAG9B,WAAW,CAAC+B,KAAK,CAACzB,KAAK,CAACa,QAAQ,CAACa,MAAM,CAAC;;IAExD;;IAEC,IAAI,CAAC/B,UAAU,CAAC6B,QAAQ,CAAC,IAAIA,QAAQ,CAAC,MAAM,CAAC,EAAEP,WAAW,CAACO,QAAQ,CAACN,IAAI,CAAC;EAC3E,CAAC,EAAE,CAAClB,KAAK,CAACa,QAAQ,CAACa,MAAM,EAAEzB,OAAO,EAAES,MAAM,EAAEV,KAAK,CAACqB,OAAO,CAAC,CAAC;EAE3D,oBACE7B,KAAA,CAAAmC,aAAA;IAAKC,SAAS,EAAE9B,MAAM,CAAC,WAAW,CAAE;IAAA+B,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAClC1C,KAAA,CAAAmC,aAAA;IAAQC,SAAS,EAAE9B,MAAM,CAAC,kBAAkB,CAAE;IAACqC,OAAO,EAAExB,cAAe;IAAAkB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACrE1C,KAAA,CAAAmC,aAAA;IACES,GAAG,EAAEvC,EAAG;IACRwC,GAAG,EAAC,SAAS;IACbT,SAAS,EAAE9B,MAAM,CAAC,uBAAuB,CAAE;IAAA+B,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAC5C,CAAC,wHAEI,CAAC,EACRjC,OAAO,iBAAIT,KAAA,CAAAmC,aAAA;IAAGW,KAAK,EAAE;MAAEC,KAAK,EAAE;IAAM,CAAE;IAAAV,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,iHAAwB,CAC7D,CAAC;AAEV,CAAC;AAED,eAAezC,UAAU,CAACM,QAAQ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}